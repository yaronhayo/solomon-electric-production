---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { IMAGES } from "../../config/images";
import BlogCard from "../../components/BlogCard.astro";
import PageHero from "../../components/PageHero.astro";
import { sortPostsByDate } from "../../utils/blog";
import Button from "../../components/ui/Button.astro";
import { SITE_CONFIG } from "../../config/site";
import { Mail, Phone } from "lucide-astro";
import Breadcrumb from "../../components/Breadcrumb.astro";

// Get all blog posts and sort by date
const allPosts = await getCollection("blog");
const posts = sortPostsByDate(allPosts);

// Get featured posts
const featuredPosts = posts.filter((p) => p.data.featured).slice(0, 3);
const regularPosts = posts.filter((p) => !p.data.featured);

const breadcrumbSchema = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    itemListElement: [
        {
            "@type": "ListItem",
            position: 1,
            name: "Home",
            item: SITE_CONFIG.seo.siteUrl,
        },
        {
            "@type": "ListItem",
            position: 2,
            name: "Blog",
            item: `${SITE_CONFIG.seo.siteUrl}/blog`,
        },
    ],
};

// Collection Page schema for blog index
const collectionPageSchema = {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "@id": `${SITE_CONFIG.seo.siteUrl}/blog/#webpage`,
    name: "Electrical Blog | Tips & Guides",
    description: "Expert electrical advice from licensed Miami electricians",
    url: `${SITE_CONFIG.seo.siteUrl}/blog`,
    isPartOf: { "@id": `${SITE_CONFIG.seo.siteUrl}/#website` },
    mainEntity: {
        "@type": "ItemList",
        numberOfItems: posts.length,
        itemListElement: posts.map((post, index) => ({
            "@type": "ListItem",
            position: index + 1,
            item: {
                "@type": "Article",
                "@id": `${SITE_CONFIG.seo.siteUrl}/blog/${post.slug}/#article`,
                headline: post.data.title,
                description: post.data.description,
                url: `${SITE_CONFIG.seo.siteUrl}/blog/${post.slug}`,
                datePublished: post.data.pubDate.toISOString(),
                author: { "@id": `${SITE_CONFIG.seo.siteUrl}/#organization` },
            },
        })),
    },
};
---

<Layout
    title="Electrical Tips & Guides | Miami | Solomon Electric"
    description="Expert electrical advice from licensed Miami electricians. Panel upgrades, EV chargers, smart home wiring, safety tips & more."
    ogImage={`${SITE_CONFIG.seo.siteUrl}/og-default.webp`}
    ogImageAlt="Solomon Electric Blog - Expert Electrical Tips & Guides for Miami Homeowners"
>
    <!-- SEO Schema -->
    <script
        type="application/ld+json"
        set:html={JSON.stringify(breadcrumbSchema)}
    />
    <script
        type="application/ld+json"
        set:html={JSON.stringify(collectionPageSchema)}
    />
    <!-- Breadcrumb Navigation -->
    <Breadcrumb items={[{ label: "Home", href: "/" }, { label: "Blog" }]} />

    <!-- Hero Section -->
    <PageHero
        title="Electrical Insights &<br><span class='text-transparent bg-clip-text bg-gradient-to-r from-accent to-white'>Guides</span>"
        subtitle="Our Blog"
        description="Expert knowledge from Miami's premier electrical contractors. Learn about services, safety, and modern electrical solutions."
        image={IMAGES.heroes.blog.src}
    />

    <!-- Featured Posts Section -->
    {
        featuredPosts.length > 0 && (
            <section class="bg-light border-b border-gray-100 py-12 md:py-32">
                <div class="container-custom">
                    <div class="mb-12 text-center md:text-left">
                        <h2 class="text-[length:var(--text-h2)] md:text-[length:var(--text-h1)] font-black text-primary mb-2 uppercase">
                            Featured Electrical{" "}
                            <span class="text-accent">Guides</span>
                        </h2>
                        <p class="text-[var(--clr-body)] font-medium">
                            Must-read guides for electrical services
                        </p>
                    </div>

                    <div
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3"
                        style="gap: var(--spacing-lg);"
                    >
                        {featuredPosts.map((post) => (
                            <BlogCard post={post} />
                        ))}
                    </div>
                </div>
            </section>
        )
    }

    <!-- All Posts Section -->
    <section class="bg-white py-12 md:py-32">
        <div class="container-custom">
            <div class="mb-12 text-center md:text-left">
                <h2
                    class="text-[length:var(--text-h2)] md:text-[length:var(--text-h1)] font-black text-primary mb-2 uppercase"
                >
                    All Electrical <span class="text-accent">Articles</span>
                </h2>
                <p class="text-[var(--clr-body)] font-medium">
                    Comprehensive guides to electrical services
                </p>
            </div>

            <div
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3"
                style="gap: var(--spacing-lg);"
            >
                {regularPosts.map((post) => <BlogCard post={post} />)}
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="bg-light py-12 md:py-32">
        <div class="container-custom">
            <div
                class="bg-[var(--bg-surface)] border border-[var(--border-light)] rounded-[var(--radius-xl)] p-12 md:p-16 text-center shadow-[var(--shadow-sm)]"
            >
                <h2
                    class="text-[length:var(--text-h2)] md:text-[length:var(--text-h1)] font-black text-primary mb-4 uppercase"
                >
                    Schedule Your Free Electrical Estimate
                </h2>
                <p
                    class="text-[var(--clr-body)] text-[length:var(--text-body)] mb-8 font-medium"
                >
                    24/7 emergency service available. Contact us today for a
                    free consultation.
                </p>
                <div class="flex flex-col md:flex-row gap-4 justify-center">
                    <Button
                        href="/contact"
                        variant="primary"
                        class="px-12 py-6 text-[length:var(--text-h5)] flex items-center gap-2"
                    >
                        <Mail class="w-5 h-5" />
                        Contact Us
                    </Button>
                    <Button
                        href={SITE_CONFIG.contact.phone.href}
                        variant="secondary"
                        class="px-12 py-6 text-[length:var(--text-h5)] flex items-center gap-2"
                    >
                        <Phone class="w-5 h-5" />
                        Call&nbsp;Now
                    </Button>
                </div>
            </div>
        </div>
    </section>
</Layout>
