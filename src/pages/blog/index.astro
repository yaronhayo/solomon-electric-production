---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import heroImage from "../../assets/images/heroes/blog.png";
import BlogCard from "../../components/BlogCard.astro";
import PageHero from "../../components/PageHero.astro";
import { sortPostsByDate } from "../../utils/blog";
import Button from "../../components/ui/Button.astro";
import { SITE_CONFIG } from "../../config/site";
import { Mail, Phone } from "lucide-astro";
import Breadcrumb from "../../components/Breadcrumb.astro";

// Get all blog posts and sort by date
const allPosts = await getCollection("blog");
const posts = sortPostsByDate(allPosts);

// Get featured posts
const featuredPosts = posts.filter((p) => p.data.featured).slice(0, 3);
const regularPosts = posts.filter((p) => !p.data.featured);

const breadcrumbSchema = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    itemListElement: [
        {
            "@type": "ListItem",
            position: 1,
            name: "Home",
            item: SITE_CONFIG.seo.siteUrl,
        },
        {
            "@type": "ListItem",
            position: 2,
            name: "Blog",
            item: `${SITE_CONFIG.seo.siteUrl}/blog`,
        },
    ],
};
---

<Layout
    title="Electrical Blog | Tips & Guides from Miami Electricians | Solomon Electric"
    description="Expert electrical advice from licensed Miami electricians. Learn about panel upgrades, EV chargers, smart home wiring, safety tips & more. Free educational content."
>
    <!-- SEO Schema -->
    <script
        type="application/ld+json"
        set:html={JSON.stringify(breadcrumbSchema)}
    />
    <!-- Breadcrumb Navigation -->
    <Breadcrumb items={[{ label: "Home", href: "/" }, { label: "Blog" }]} />

    <!-- Hero Section -->
    <PageHero
        title="Electrical Insights &<br/><span class='text-transparent bg-clip-text bg-gradient-to-r from-accent to-white'>Guides</span>"
        subtitle="Our Blog"
        description="Expert knowledge from Miami's premier electrical contractors. Learn about services, safety, and modern electrical solutions."
        image={heroImage}
    />

    <!-- Featured Posts Section -->
    {
        featuredPosts.length > 0 && (
            <section
                class="bg-light border-b border-gray-100"
                style="padding-top: var(--spacing-3xl); padding-bottom: var(--spacing-3xl);"
            >
                <div class="container-custom">
                    <div class="mb-12 text-center md:text-left">
                        <h2 class="text-3xl md:text-4xl font-black text-primary mb-2 uppercase">
                            Featured <span class="text-accent">Articles</span>
                        </h2>
                        <p class="text-[var(--text-body)] font-medium">
                            Must-read guides for electrical services
                        </p>
                    </div>

                    <div
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3"
                        style="gap: var(--spacing-lg);"
                    >
                        {featuredPosts.map((post) => (
                            <BlogCard post={post} />
                        ))}
                    </div>
                </div>
            </section>
        )
    }

    <!-- All Posts Section -->
    <section
        class="bg-white"
        style="padding-top: var(--spacing-3xl); padding-bottom: var(--spacing-3xl);"
    >
        <div class="container-custom">
            <div class="mb-12 text-center md:text-left">
                <h2
                    class="text-3xl md:text-4xl font-black text-primary mb-2 uppercase"
                >
                    All <span class="text-accent">Articles</span>
                </h2>
                <p class="text-[var(--text-body)] font-medium">
                    Comprehensive guides to electrical services
                </p>
            </div>

            <div
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3"
                style="gap: var(--spacing-lg);"
            >
                {regularPosts.map((post) => <BlogCard post={post} />)}
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section
        class="bg-light"
        style="padding-top: var(--spacing-3xl); padding-bottom: var(--spacing-3xl);"
    >
        <div class="container-custom">
            <div
                class="bg-[var(--bg-surface)] border border-[var(--border-light)] rounded-[var(--radius-xl)] p-12 md:p-16 text-center shadow-[var(--shadow-sm)]"
            >
                <h2
                    class="text-3xl md:text-4xl font-black text-primary mb-4 uppercase"
                >
                    Ready to Get Started?
                </h2>
                <p class="text-[var(--text-body)] text-lg mb-8 font-medium">
                    24/7 emergency service available. Contact us today for a
                    free consultation.
                </p>
                <div class="flex flex-col md:flex-row gap-4 justify-center">
                    <Button
                        href="/contact"
                        variant="primary"
                        class="px-12 py-6 text-xl flex items-center gap-2"
                    >
                        <Mail class="w-5 h-5" />
                        Contact Us
                    </Button>
                    <Button
                        href={SITE_CONFIG.contact.phone.href}
                        variant="secondary"
                        class="px-12 py-6 text-xl flex items-center gap-2"
                    >
                        <Phone class="w-5 h-5" />
                        Call Now
                    </Button>
                </div>
            </div>
        </div>
    </section>
</Layout>
