---
import { getCollection } from "astro:content";

export const prerender = true;

import Layout from "../../layouts/Layout.astro";
import Container from "../../components/ui/Container.astro";
import { Image } from "astro:assets";
import SocialShare from "../../components/SocialShare.astro";
import BlogCard from "../../components/BlogCard.astro";
import Button from "../../components/ui/Button.astro";
import CtaButton from "../../components/ui/CtaButton.astro";
import PhoneNumber from "../../components/ui/PhoneNumber.astro";
import {
    formatDate,
    calculateReadingTime,
    findRelatedPosts,
} from "../../utils/blog";
import {
    generateArticleSchema,
    generateBreadcrumbSchema,
    generateFAQSchema,
} from "../../utils/seo";
import { SITE_CONFIG } from "../../config/site";
import Breadcrumb from "../../components/Breadcrumb.astro";
import {
    Calendar,
    Clock,
    User,
    ArrowRight,
    Zap,
    Phone,
    ChevronDown,
    MessageCircle,
} from "lucide-astro";

export async function getStaticPaths() {
    const posts = await getCollection("blog");
    return posts.map((post) => ({
        params: { slug: post.slug },
        props: post,
    }));
}

const post = Astro.props;
const { Content } = await post.render();

const allPosts = await getCollection("blog");
const relatedPosts = findRelatedPosts(post, allPosts, 3);
const readingTime = calculateReadingTime(post.body);

const siteUrl = SITE_CONFIG.seo.siteUrl;
const articleSchema = generateArticleSchema(post, siteUrl);
const breadcrumbSchema = generateBreadcrumbSchema(
    [
        { name: "Home", url: "/" },
        { name: "Blog", url: "/blog" },
        { name: post.data.title, url: `/blog/${post.slug}` },
    ],
    siteUrl,
);

const currentUrl = `${siteUrl}/blog/${post.slug}`;

const getOgImageUrl = () => {
    if (!post.data.image) return undefined;
    const imageSrc =
        typeof post.data.image === "string"
            ? post.data.image
            : post.data.image.src;
    return imageSrc.startsWith("http") ? imageSrc : `${siteUrl}${imageSrc}`;
};
const ogImageUrl = getOgImageUrl();
const faqs = post.data.faqs || [];
---

<Layout
    title={post.data.title}
    description={post.data.description}
    ogImage={ogImageUrl}
    ogImageAlt={post.data.imageAlt || post.data.title}
    ogType="article"
>
    <script
        type="application/ld+json"
        set:html={JSON.stringify(articleSchema)}
    />
    <script
        type="application/ld+json"
        set:html={JSON.stringify(breadcrumbSchema)}
    />
    {
        faqs.length > 0 && (
            <script
                type="application/ld+json"
                set:html={JSON.stringify(generateFAQSchema(faqs))}
            />
        )
    }

    <!-- Article-specific meta (not handled by Layout) -->
    <meta
        slot="head"
        property="article:published_time"
        content={post.data.pubDate.toISOString()}
    />
    {
        post.data.updatedDate && (
            <meta
                slot="head"
                property="article:modified_time"
                content={post.data.updatedDate.toISOString()}
            />
        )
    }
    <meta
        slot="head"
        property="article:author"
        content={post.data.author || "Solomon Electric Team"}
    />
    <meta slot="head" property="article:section" content={post.data.category} />
    {
        post.data.tags &&
            post.data.tags.map((tag: string) => (
                <meta slot="head" property="article:tag" content={tag} />
            ))
    }

    <Breadcrumb
        items={[
            { label: "Home", href: "/" },
            { label: "Blog", href: "/blog" },
            { label: post.data.title },
        ]}
    />

    <!-- HERO -->
    <header class="blog-hero">
        <div class="blog-hero__bg"></div>
        <Container>
            <div class="blog-hero__inner">
                <span class="blog-hero__category">{post.data.category}</span>
                <h1 class="blog-hero__title">{post.data.title}</h1>
                <p class="blog-hero__desc">{post.data.description}</p>
                <div class="blog-hero__meta">
                    <span
                        ><Calendar class="icon" />
                        {formatDate(post.data.pubDate)}</span
                    >
                    <span><Clock class="icon" /> {readingTime} min read</span>
                    <span><User class="icon" /> {post.data.author}</span>
                </div>
            </div>
        </Container>
    </header>

    <!-- FEATURED IMAGE -->
    {
        post.data.image && (
            <section class="blog-image">
                <Container>
                    <figure class="blog-image__figure">
                        <Image
                            src={post.data.image}
                            alt={post.data.imageAlt || post.data.title}
                            loading="eager"
                            fetchpriority="high"
                            class="blog-image__img"
                        />
                    </figure>
                </Container>
            </section>
        )
    }

    <!-- CONTENT -->
    <main class="blog-main">
        <Container>
            <div class="blog-layout">
                <!-- Sidebar -->
                <aside class="blog-sidebar">
                    <div class="blog-sidebar__sticky">
                        <div class="blog-sidebar__card">
                            <div class="blog-sidebar__cta">
                                <Zap class="blog-sidebar__icon" />
                                <p class="blog-sidebar__cta-title">
                                    Need Electrical Help?
                                </p>
                                <p class="blog-sidebar__cta-text">
                                    Expert electricians available 24/7
                                </p>
                                <Button
                                    href="/book"
                                    variant="primary"
                                    size="sm"
                                    class="blog-sidebar__btn"
                                >
                                    Get Free Quote
                                </Button>
                                <a
                                    href={SITE_CONFIG.contact.phone.href}
                                    class="blog-sidebar__phone"
                                >
                                    <Phone class="icon" />
                                    <PhoneNumber />
                                </a>
                            </div>
                        </div>
                        <div class="blog-sidebar__share">
                            <p class="blog-sidebar__share-label">
                                Share Article
                            </p>
                            <SocialShare
                                currentUrl={currentUrl}
                                title={post.data.title}
                            />
                        </div>
                    </div>
                </aside>

                <!-- Article -->
                <article class="blog-article">
                    <div class="blog-content">
                        <Content />
                    </div>

                    <!-- Tags -->
                    {
                        post.data.tags && post.data.tags.length > 0 && (
                            <div class="blog-tags">
                                <span class="blog-tags__label">Topics:</span>
                                {post.data.tags.map((tag: string) => (
                                    <span class="blog-tags__tag">{tag}</span>
                                ))}
                            </div>
                        )
                    }
                </article>
            </div>
        </Container>
    </main>

    <!-- FAQ SECTION -->
    {
        faqs.length > 0 && (
            <section class="blog-faq">
                <Container>
                    <div class="blog-faq__inner">
                        <div class="blog-faq__header">
                            <MessageCircle class="blog-faq__header-icon" />
                            <h2 class="blog-faq__title">
                                Frequently Asked Electrical Questions
                            </h2>
                        </div>
                        <div class="blog-faq__list" id="faq-accordion">
                            {faqs.map(
                                (
                                    faq: { question: string; answer: string },
                                    i: number,
                                ) => (
                                    <div class="faq-item" data-faq>
                                        <button
                                            type="button"
                                            class="faq-item__q"
                                            aria-expanded="false"
                                            aria-controls={`blog-faq-answer-${i}`}
                                            id={`blog-faq-question-${i}`}
                                            data-faq-btn={i}
                                        >
                                            <span>{faq.question}</span>
                                            <ChevronDown class="faq-item__chevron" />
                                        </button>
                                        <div
                                            class="faq-item__a"
                                            id={`blog-faq-answer-${i}`}
                                            data-faq-answer={i}
                                            role="region"
                                            aria-labelledby={`blog-faq-question-${i}`}
                                        >
                                            <p>{faq.answer}</p>
                                        </div>
                                    </div>
                                ),
                            )}
                        </div>
                    </div>
                </Container>
            </section>
        )
    }

    <!-- CTA SECTION -->
    <section class="blog-cta">
        <Container>
            <div class="blog-cta__inner">
                <div class="blog-cta__content">
                    <h2 class="blog-cta__title">
                        Schedule Your Free Electrical Estimate
                    </h2>
                    <p class="blog-cta__text">
                        Professional electrical services in Miami. Licensed,
                        insured, and available 24/7.
                    </p>
                </div>
                <div class="blog-cta__actions">
                    <Button href="/book" variant="primary" size="lg">
                        <Zap class="icon" /> Schedule Service
                    </Button>
                    <CtaButton
                        action="call"
                        variant="secondary"
                        size="lg"
                        text="CallÂ Now"
                    />
                </div>
            </div>
        </Container>
    </section>

    <!-- RELATED POSTS -->
    {
        relatedPosts.length > 0 && (
            <section class="blog-related">
                <Container>
                    <h2 class="blog-related__title">
                        Related Electrical Articles
                    </h2>
                    <div class="blog-related__grid">
                        {relatedPosts.map((p: any) => (
                            <BlogCard post={p} />
                        ))}
                    </div>
                    <div class="blog-related__more">
                        <Button href="/blog" variant="secondary">
                            View All Articles <ArrowRight class="icon" />
                        </Button>
                    </div>
                </Container>
            </section>
        )
    }
</Layout>

<style>
    /* =============================================
   PREMIUM BLOG POST TEMPLATE
   Clean, Modern, Professional Design
============================================= */

    :root {
        --blog-wide: 900px;
    }

    /* ---------- HERO ---------- */
    .blog-hero {
        position: relative;
        padding: clamp(3rem, 6vw, 5rem) 0 60px;
        overflow: hidden;
    }

    .blog-hero__bg {
        position: absolute;
        inset: 0;
        background: linear-gradient(
            135deg,
            var(--color-primary-dark) 0%,
            var(--color-primary) 50%,
            var(--color-primary-light) 100%
        );
        z-index: 0;
    }

    .blog-hero__bg::before {
        content: "";
        position: absolute;
        inset: 0;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2314D3E3' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }

    .blog-hero__inner {
        position: relative;
        z-index: 1;
        max-width: var(--blog-wide);
        margin: 0 auto;
        text-align: center;
    }

    .blog-hero__category {
        display: inline-block;
        background: rgba(var(--color-accent-rgb), 0.15);
        color: var(--color-accent);
        padding: clamp(0.375rem, 0.75vw, 0.5rem) clamp(1rem, 2vw, 1.25rem);
        border-radius: var(--radius-full);
        font-size: var(--text-micro);
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        margin-bottom: var(--spacing-lg);
    }

    .blog-hero__title {
        color: var(--text-inverse);
        font-size: var(--text-h1);
        font-weight: 800;
        line-height: 1.15;
        margin: 0 0 var(--spacing-md);
        font-family: var(--font-display);
    }

    .blog-hero__desc {
        color: rgba(255, 255, 255, 0.85);
        font-size: var(--text-body);
        line-height: 1.6;
        max-width: 650px;
        margin: 0 auto var(--spacing-lg);
    }

    .blog-hero__meta {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: var(--spacing-lg);
        color: rgba(255, 255, 255, 0.75);
        font-size: var(--text-caption);
    }

    .blog-hero__meta span {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
    }

    .blog-hero__meta .icon {
        width: 16px;
        height: 16px;
        color: var(--color-accent);
    }

    /* ---------- FEATURED IMAGE ---------- */
    .blog-image {
        position: relative;
        margin-top: calc(-1 * var(--spacing-lg));
        padding-bottom: var(--spacing-xl);
        background: var(--color-light);
    }

    .blog-image__figure {
        max-width: var(--blog-wide);
        margin: 0 auto;
        border-radius: var(--radius-lg);
        overflow: hidden;
        box-shadow: var(--shadow-lg);
    }

    .blog-image__img {
        width: 100%;
        height: auto;
        display: block;
    }

    /* ---------- MAIN LAYOUT ---------- */
    .blog-main {
        background: var(--bg-surface);
        padding: clamp(2.5rem, 5vw, 3.75rem) 0 clamp(3rem, 6vw, 5rem);
    }

    .blog-layout {
        display: grid;
        grid-template-columns: 1fr 280px;
        gap: var(--spacing-2xl);
        max-width: 1100px;
        margin: 0 auto;
    }

    @media (max-width: 1024px) {
        .blog-layout {
            grid-template-columns: 1fr;
            gap: var(--spacing-lg);
        }
    }

    /* ---------- SIDEBAR ---------- */
    .blog-sidebar {
        order: 2;
    }

    @media (max-width: 1024px) {
        .blog-sidebar {
            order: -1;
        }
    }

    .blog-sidebar__sticky {
        position: sticky;
        top: 140px;
        padding-top: var(--spacing-md);
    }

    .blog-sidebar__card {
        background: linear-gradient(
            145deg,
            var(--color-primary) 0%,
            var(--color-primary-dark) 100%
        );
        border-radius: var(--radius-lg);
        padding: clamp(1.5rem, 3vw, 2rem) clamp(1.25rem, 2.5vw, 1.75rem);
        margin-bottom: var(--spacing-md);
        color: var(--text-inverse);
        box-shadow: var(--shadow-primary-glow);
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
    }

    .blog-sidebar__card::before {
        content: "";
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle,
            rgba(var(--color-accent-rgb), 0.15) 0%,
            transparent 70%
        );
        pointer-events: none;
    }

    .blog-sidebar__cta {
        position: relative;
        z-index: 1;
    }

    .blog-sidebar__icon {
        width: 48px;
        height: 48px;
        padding: clamp(0.5rem, 1vw, 0.625rem);
        background: rgba(var(--color-accent-rgb), 0.25);
        border-radius: var(--radius-lg);
        color: var(--color-accent);
        margin-bottom: 20px;
        border: 1px solid rgba(var(--color-accent-rgb), 0.3);
    }

    .blog-sidebar__cta-title {
        font-size: var(--text-h5);
        font-weight: 800;
        margin: 0 0 8px;
        font-family: var(--font-display);
        color: var(--text-inverse);
    }

    .blog-sidebar__cta-text {
        font-size: var(--text-caption);
        color: rgba(255, 255, 255, 0.85);
        margin: 0 0 24px;
        line-height: 1.5;
    }

    .blog-sidebar__btn {
        width: 100%;
        justify-content: center;
        margin-bottom: 16px;
    }

    .blog-sidebar__phone {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-xs);
        color: var(--text-inverse);
        font-size: var(--text-nav);
        font-weight: 700;
        text-decoration: none;
        padding: clamp(0.75rem, 1.5vw, 0.875rem) clamp(0.875rem, 1.75vw, 1rem);
        border-radius: var(--radius-lg);
        background: linear-gradient(
            135deg,
            var(--color-accent) 0%,
            var(--color-accent-dark) 100%
        );
        border: none;
        transition: all 0.2s;
        box-shadow: var(--shadow-accent-sm);
    }

    .blog-sidebar__phone:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-accent-lg);
    }

    .blog-sidebar__phone .icon {
        width: 18px;
        height: 18px;
    }

    .blog-sidebar__share {
        background: var(--bg-surface);
        border-radius: var(--radius-lg);
        padding: clamp(1.25rem, 2.5vw, 1.5rem) clamp(1rem, 2vw, 1.25rem);
        text-align: center;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-light);
    }

    .blog-sidebar__share-label {
        font-size: var(--text-micro);
        font-weight: 700;
        color: var(--color-primary);
        text-transform: uppercase;
        letter-spacing: 1.5px;
        margin: 0 0 16px;
    }

    /* ---------- ARTICLE CONTENT ---------- */
    .blog-article {
        order: 1;
        min-width: 0;
    }

    .blog-content {
        font-size: var(--text-body);
        line-height: 1.8;
        color: var(--text-body);
    }

    /* Headings */
    .blog-content :global(h1) {
        font-size: var(--text-h2);
        font-weight: 800;
        color: var(--color-primary);
        margin: 0 0 24px;
        line-height: 1.2;
        font-family: var(--font-display);
    }

    .blog-content :global(h2) {
        font-size: var(--text-h3);
        font-weight: 700;
        color: var(--color-primary);
        margin: var(--spacing-xl) 0 var(--spacing-md);
        padding-bottom: 12px;
        border-bottom: 3px solid var(--color-accent);
        line-height: 1.25;
        font-family: var(--font-display);
    }

    .blog-content :global(h3) {
        font-size: var(--text-h4);
        font-weight: 700;
        color: var(--color-primary);
        margin: var(--spacing-lg) 0 var(--spacing-md);
        line-height: 1.3;
        font-family: var(--font-secondary);
    }

    .blog-content :global(h4) {
        font-size: var(--text-body);
        font-weight: 700;
        color: var(--color-accent);
        margin: var(--spacing-md) 0 var(--spacing-sm);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    /* Paragraphs */
    .blog-content :global(p) {
        margin: 0 0 24px;
    }

    /* Lead paragraph */
    .blog-content > :global(p:first-of-type) {
        font-size: var(--text-h5);
        color: var(--color-primary);
        font-weight: 500;
    }

    /* Links */
    .blog-content :global(a) {
        color: var(--color-accent);
        font-weight: 600;
        text-decoration: underline;
        text-decoration-thickness: 2px;
        text-underline-offset: 3px;
        transition: color 0.2s;
    }

    .blog-content :global(a:hover) {
        color: var(--color-primary);
    }

    /* Strong */
    .blog-content :global(strong) {
        color: var(--color-primary);
        font-weight: 700;
    }

    /* Lists */
    .blog-content :global(ul),
    .blog-content :global(ol) {
        margin: 0 0 28px;
        padding-left: 0;
        list-style: none;
    }

    .blog-content :global(li) {
        position: relative;
        padding: clamp(0.625rem, 1.25vw, 0.75rem) 0
            clamp(0.625rem, 1.25vw, 0.75rem) clamp(1.5rem, 3vw, 2rem);
        border-bottom: 1px solid var(--border-light);
    }

    .blog-content :global(li:last-child) {
        border-bottom: none;
    }

    .blog-content :global(li::before) {
        content: "";
        position: absolute;
        left: 0;
        top: 18px;
        width: 8px;
        height: 8px;
        background: var(--color-accent);
        border-radius: 50%;
    }

    .blog-content :global(ol) {
        counter-reset: list-counter;
    }

    .blog-content :global(ol li) {
        counter-increment: list-counter;
    }

    .blog-content :global(ol li::before) {
        content: counter(list-counter);
        width: 24px;
        height: 24px;
        background: var(--color-primary);
        color: var(--text-inverse);
        border-radius: 50%;
        font-size: var(--text-micro);
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
        top: 12px;
    }

    /* Nested lists */
    .blog-content :global(li ul),
    .blog-content :global(li ol) {
        margin: var(--spacing-sm) 0 0;
    }

    .blog-content :global(li li) {
        padding: clamp(0.375rem, 0.75vw, 0.5rem) 0
            clamp(0.375rem, 0.75vw, 0.5rem) clamp(1.25rem, 2.5vw, 1.5rem);
        font-size: var(--text-nav);
    }

    .blog-content :global(li li::before) {
        width: 6px;
        height: 6px;
        top: 14px;
        background: var(--text-muted);
    }

    /* Blockquotes */
    .blog-content :global(blockquote) {
        margin: var(--spacing-lg) 0;
        padding: clamp(1.25rem, 2.5vw, 1.5rem) clamp(1.25rem, 2.5vw, 1.75rem);
        background: var(--color-light);
        border-left: 4px solid var(--color-accent);
        border-radius: 0 var(--radius) var(--radius) 0;
    }

    .blog-content :global(blockquote p) {
        margin: 0;
        font-size: var(--text-body);
        font-style: italic;
        color: var(--color-primary);
    }

    /* HR */
    .blog-content :global(hr) {
        border: none;
        height: 1px;
        background: linear-gradient(
            90deg,
            transparent,
            var(--color-accent),
            transparent
        );
        margin: var(--spacing-xl) 0;
    }

    /* Code */
    .blog-content :global(code) {
        background: var(--bg-surface-hover);
        color: var(--color-primary);
        padding: 0.125rem clamp(0.375rem, 0.75vw, 0.5rem);
        border-radius: var(--radius-md);
        font-size: var(--text-label);
        font-family: "SF Mono", Monaco, monospace;
    }

    .blog-content :global(pre) {
        background: var(--color-dark);
        color: var(--color-light);
        padding: clamp(1.25rem, 2.5vw, 1.5rem);
        border-radius: var(--radius);
        overflow-x: auto;
        margin: var(--spacing-md) 0;
    }

    /* Images */
    .blog-content :global(img) {
        border-radius: var(--radius);
        box-shadow: var(--shadow-md);
        margin: var(--spacing-md) 0;
        max-width: 100%;
    }

    /* Inline CTA boxes */
    .blog-content :global(.bg-gray-50),
    .blog-content :global(div[class*="bg-gray"]) {
        background: var(--color-light);
        border: 1px solid var(--border-light);
        padding: clamp(1.25rem, 2.5vw, 1.5rem);
        border-radius: var(--radius);
        margin: var(--spacing-md) 0;
    }

    /* Tables */
    .blog-content :global(table) {
        width: 100%;
        border-collapse: collapse;
        margin: var(--spacing-md) 0;
        font-size: var(--text-nav);
    }

    .blog-content :global(th),
    .blog-content :global(td) {
        padding: clamp(0.625rem, 1.25vw, 0.75rem) clamp(0.875rem, 1.75vw, 1rem);
        text-align: left;
        border-bottom: 1px solid var(--border-light);
    }

    .blog-content :global(th) {
        background: var(--color-primary);
        color: var(--text-inverse);
        font-weight: 600;
    }

    .blog-content :global(tr:hover) {
        background: var(--color-light);
    }

    /* ---------- TAGS ---------- */
    .blog-tags {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: var(--spacing-xs);
        margin-top: 48px;
        padding-top: 32px;
        border-top: 1px solid var(--border-light);
    }

    .blog-tags__label {
        font-size: var(--text-caption);
        font-weight: 600;
        color: var(--text-muted);
    }

    .blog-tags__tag {
        background: var(--bg-surface-hover);
        color: var(--color-primary);
        padding: clamp(0.25rem, 0.5vw, 0.375rem) clamp(0.75rem, 1.5vw, 0.875rem);
        border-radius: var(--radius-full);
        font-size: var(--text-caption);
        font-weight: 500;
        transition: all 0.2s;
    }

    .blog-tags__tag:hover {
        background: var(--color-accent);
        color: var(--text-inverse);
    }

    /* ---------- FAQ SECTION ---------- */
    .blog-faq {
        background: linear-gradient(
            180deg,
            var(--color-light) 0%,
            var(--bg-surface) 100%
        );
        padding: clamp(3rem, 6vw, 5rem) 0;
        border-top: 1px solid var(--border-light);
    }

    .blog-faq__inner {
        max-width: 800px;
        margin: 0 auto;
    }

    .blog-faq__header {
        text-align: center;
        margin-bottom: 48px;
    }

    .blog-faq__header-icon {
        width: 56px;
        height: 56px;
        padding: clamp(0.75rem, 1.5vw, 0.875rem);
        background: linear-gradient(
            135deg,
            var(--color-primary) 0%,
            var(--color-accent) 100%
        );
        color: var(--text-inverse);
        border-radius: var(--radius-xl);
        margin: 0 auto 20px;
        box-shadow: var(--shadow-primary-glow);
    }

    .blog-faq__title {
        font-size: var(--text-h2);
        font-weight: 800;
        color: var(--color-primary);
        margin: 0;
        font-family: var(--font-display);
    }

    .faq-item {
        background: var(--bg-surface);
        border-radius: var(--radius);
        margin-bottom: 12px;
        box-shadow: var(--shadow-sm);
        overflow: hidden;
        transition: all 0.2s;
        border: 1px solid var(--border-light);
    }

    .faq-item:hover {
        box-shadow: var(--shadow-md);
        border-color: var(--border-light);
    }

    .faq-item.active {
        border-color: var(--color-accent);
        box-shadow: var(--shadow-accent-sm);
    }

    .faq-item__q {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        padding: clamp(1.125rem, 2.25vw, 1.375rem) clamp(1.25rem, 2.5vw, 1.5rem);
        background: none;
        border: none;
        cursor: pointer;
        text-align: left;
        font-size: var(--text-body-sm);
        font-weight: 600;
        color: var(--color-primary);
        font-family: var(--font-display);
    }

    .faq-item__chevron {
        width: 22px;
        height: 22px;
        color: var(--color-accent);
        transition: transform 0.3s;
        flex-shrink: 0;
        margin-left: 16px;
    }

    .faq-item.active .faq-item__chevron {
        transform: rotate(180deg);
    }

    .faq-item__a {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
    }

    .faq-item__a p {
        padding: 0 24px 24px;
        margin: 0;
        color: var(--text-muted);
        line-height: 1.75;
        font-size: var(--text-nav);
    }

    /* ---------- CTA SECTION ---------- */
    .blog-cta {
        background: linear-gradient(
            135deg,
            var(--color-primary) 0%,
            var(--color-primary-dark) 100%
        );
        padding: clamp(3rem, 10vw, 8rem) 0;
        position: relative;
        overflow: hidden;
    }

    .blog-cta::before {
        content: "";
        position: absolute;
        inset: 0;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2314D3E3' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        pointer-events: none;
    }

    .blog-cta__inner {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: var(--spacing-lg);
        flex-wrap: wrap;
        position: relative;
        z-index: 1;
    }

    .blog-cta__content {
        flex: 1;
        min-width: 280px;
    }

    .blog-cta__title {
        font-size: var(--text-h3);
        font-weight: 800;
        color: var(--text-inverse);
        margin: 0 0 10px;
        font-family: var(--font-display);
    }

    .blog-cta__text {
        color: rgba(255, 255, 255, 0.9);
        font-size: var(--text-body-sm);
        margin: 0;
        line-height: 1.5;
    }

    .blog-cta__actions {
        display: flex;
        gap: var(--spacing-sm);
        flex-wrap: wrap;
    }

    /* ---------- RELATED POSTS ---------- */
    .blog-related {
        background: var(--bg-surface);
        padding: clamp(3rem, 10vw, 8rem) 0;
        border-top: 1px solid var(--border-light);
    }

    .blog-related__title {
        font-size: var(--text-h3);
        font-weight: 800;
        color: var(--color-primary);
        text-align: center;
        margin: 0 0 48px;
        font-family: var(--font-display);
    }

    .blog-related__grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: var(--spacing-lg);
        max-width: 1100px;
        margin: 0 auto;
    }

    .blog-related__more {
        text-align: center;
        margin-top: 48px;
    }

    /* ---------- UTILITIES ---------- */
    .icon {
        width: 18px;
        height: 18px;
        flex-shrink: 0;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const items = document.querySelectorAll("[data-faq]");
        items.forEach((item) => {
            const btn = item.querySelector("[data-faq-btn]");
            const answer = item.querySelector(
                "[data-faq-answer]",
            ) as HTMLElement;
            if (btn && answer) {
                btn.addEventListener("click", () => {
                    const isOpen = item.classList.contains("active");
                    // Close all
                    items.forEach((i) => {
                        i.classList.remove("active");
                        const b = i.querySelector("[data-faq-btn]");
                        const a = i.querySelector(
                            "[data-faq-answer]",
                        ) as HTMLElement;
                        if (b) b.setAttribute("aria-expanded", "false");
                        if (a) a.style.maxHeight = "0";
                    });
                    // Toggle current
                    if (!isOpen) {
                        item.classList.add("active");
                        btn.setAttribute("aria-expanded", "true");
                        answer.style.maxHeight = answer.scrollHeight + "px";
                    }
                });
            }
        });
    });
</script>
