---
import Layout from "../layouts/Layout.astro";
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import heroImage from "../assets/images/heroes/homepage.png"; // Updated hero image
import customerInteractionImage from "../assets/images/enhancements/customer-interaction.png";
import trustBgImage from "../assets/images/enhancements/trust-bg.png";
import ReviewCarousel from "../components/ReviewCarousel.astro";
import FAQAccordion from "../components/FAQAccordion.astro";
import LatestBlogPosts from "../components/LatestBlogPosts.astro";
import {
    getServices,
    getFeaturedServices,
    serviceCategories,
    getCategoryInfo,
    categoryImages,
} from "../utils/services";
import { SERVICE_AREAS } from "../data/service-areas";
import { SITE_CONFIG } from "../config/site";
import Button from "../components/ui/Button.astro";
import CtaButton from "../components/ui/CtaButton.astro";
import Container from "../components/ui/Container.astro";
import BookingForm from "../components/BookingForm.astro";
import PageHero from "../components/PageHero.astro";
import ServiceAreaMap from "../components/ServiceAreaMap.astro";
import { generateHomepageSchema, generateFAQSchema } from "../utils/seo";

// For featured carousel, get first 3 services
const allServices = await getServices();
// featuredServices variable not used, using explicit getFeaturedServices call logic instead
const featuredServicesList = await getFeaturedServices();

// Get FAQs for schema (homepage displays first 6)
const globalFaqs = await getCollection("faqs");
const sortedFaqs = globalFaqs
    .sort((a, b) => parseInt(a.data.id) - parseInt(b.data.id))
    .slice(0, 6);
const faqsForSchema = sortedFaqs.map((faq) => ({
    question: faq.data.question,
    answer: faq.data.answer,
}));

const stats = [
    {
        number: SITE_CONFIG.stats.residentialProjects,
        label: "Residential Projects",
    },
    { number: SITE_CONFIG.stats.commercialJobs, label: "Commercial Jobs" },
    {
        number: SITE_CONFIG.stats.industrialSystems,
        label: "Industrial Systems",
    },
    { number: SITE_CONFIG.stats.happyClients, label: "Happy Clients" },
];

const serviceAreas = SERVICE_AREAS;

// Generate Consolidated Homepage Schema (@graph)
const homepageSchema = generateHomepageSchema(SITE_CONFIG.seo.siteUrl);

// Generate FAQ Schema for homepage FAQs (GSC rich result)
const faqSchema = generateFAQSchema(faqsForSchema);

import { Phone, Calendar, ArrowRight, Grid, Zap } from "lucide-astro";
---

<Layout
    title="Electrician Miami | 24/7 Licensed Electrical Services | Solomon Electric"
    description="Top-rated electrician in Miami, Fort Lauderdale & South Florida. 24/7 emergency service, panel upgrades, EV charger installation. Licensed #EC13012419. Call (786) 833-9211!"
>
    <!-- Schema Markup -->
    <script
        type="application/ld+json"
        set:html={JSON.stringify(homepageSchema)}
    />
    <!-- FAQ Schema for Rich Results -->
    <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />

    <!-- Hero Section -->
    <PageHero
        title="Electrical Problems?<br/><span class='text-transparent bg-clip-text bg-gradient-to-r from-accent to-white'>We'll Fix Them Today</span>"
        subtitle="Licensed Electricians • Miami-Dade • Broward • Palm Beach"
        description="Flickering lights, tripping breakers, or sparking outlets aren't just annoying—they're safety risks. Since 2008, South Florida families and businesses have trusted us to solve these exact problems. With 19,400+ projects completed, our licensed electricians diagnose your issues fast and fix them right the first time, giving you back the peace of mind you deserve."
        image={heroImage}
        trustIndicators={true}
        showScrollIndicator={true}
        primaryCta={{
            text: "Get Help Now",
            href: "/book",
            icon: Calendar,
        }}
        secondaryCta={{
            text: "See What We Fix",
            href: "/services",
            icon: Zap,
        }}
    >
        <BookingForm slot="visual" />
    </PageHero>

    <!-- Trust Bar - Certifications and Guarantees -->
    <section
        id="trust-indicators"
        aria-labelledby="trust-heading"
        class="relative border-b border-gray-100 overflow-hidden py-16 md:py-24"
    >
        <h2 id="trust-heading" class="sr-only">Why Trust Solomon Electric</h2>
        <div class="absolute inset-0 z-0">
            <Image
                src={trustBgImage}
                alt=""
                class="w-full h-full object-cover opacity-5"
                loading="lazy"
                widths={[400, 800, 1200]}
            />
        </div>
        <Container class="relative z-10">
            <div
                class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-4 text-center reveal reveal-up"
                style="gap: var(--spacing-xl);"
            >
                <div
                    class="flex flex-col items-center group"
                    style="gap: var(--spacing-md);"
                >
                    <div
                        class="w-16 h-16 rounded-full bg-white shadow-sm flex items-center justify-center group-hover:shadow-md transition-all group-hover:-translate-y-1 shimmer-authority"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="w-8 h-8 text-accent"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                            ></path>
                        </svg>
                    </div>
                    <div>
                        <span
                            class="block text-lg font-bold text-primary uppercase leading-tight font-secondary"
                            style="margin-bottom: var(--spacing-xs);"
                            >Licensed & Insured</span
                        >
                        <span
                            class="text-xs font-bold text-[var(--text-body)] uppercase tracking-wide"
                            >Your Safety Guaranteed</span
                        >
                    </div>
                </div>

                <div
                    class="flex flex-col items-center group"
                    style="gap: var(--spacing-md);"
                >
                    <div
                        class="w-16 h-16 rounded-full bg-white shadow-sm flex items-center justify-center group-hover:shadow-md transition-all group-hover:-translate-y-1"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="w-8 h-8 text-accent"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                            ></path>
                        </svg>
                    </div>
                    <div>
                        <span
                            class="block text-lg font-bold text-primary mb-1 uppercase leading-tight font-secondary"
                            >Emergency Service</span
                        >
                        <span
                            class="text-xs font-bold text-[var(--text-body)] uppercase tracking-wide"
                            >Here When Needed</span
                        >
                    </div>
                </div>

                <div
                    class="flex flex-col items-center group"
                    style="gap: var(--spacing-md);"
                >
                    <div
                        class="w-16 h-16 rounded-full bg-white shadow-sm flex items-center justify-center group-hover:shadow-md transition-all group-hover:-translate-y-1"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="w-8 h-8 text-accent"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                            ></path>
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <span
                            class="block text-lg font-bold text-primary mb-1 uppercase leading-tight font-secondary"
                            >Local Experts</span
                        >
                        <span
                            class="text-xs font-bold text-[var(--text-body)] uppercase tracking-wide"
                            >We Know Miami Code</span
                        >
                    </div>
                </div>

                <div
                    class="flex flex-col items-center group"
                    style="gap: var(--spacing-md);"
                >
                    <div
                        class="w-16 h-16 rounded-full bg-white shadow-sm flex items-center justify-center group-hover:shadow-md transition-all group-hover:-translate-y-1"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="w-8 h-8 text-accent"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"
                            ></path>
                        </svg>
                    </div>
                    <div>
                        <span
                            class="block text-lg font-bold text-primary mb-1 uppercase leading-tight font-secondary"
                            >Satisfaction First</span
                        >
                        <span
                            class="text-xs font-bold text-[var(--text-body)] uppercase tracking-wide"
                            >Quality You Can Trust</span
                        >
                    </div>
                </div>
            </div>
        </Container>
    </section>

    <!-- Featured Services Carousel (Enhanced existing) -->
    <section
        id="featured-services"
        aria-labelledby="services-heading"
        class="bg-white py-20 md:py-32"
    >
        <Container>
            <div
                class="text-center reveal reveal-up"
                style="margin-bottom: var(--spacing-3xl);"
            >
                <p
                    class="text-accent font-bold text-lg tracking-[0.2em] uppercase font-secondary"
                    style="margin-bottom: var(--spacing-md);"
                >
                    How We Serve You
                </p>
                <h2
                    id="services-heading"
                    class="text-3xl md:text-5xl font-black text-primary uppercase"
                >
                    Expert <span class="text-accent">Electrical Solutions</span>
                </h2>
            </div>

            <div
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 reveal reveal-up"
                style="gap: var(--spacing-xl);"
            >
                {
                    featuredServicesList.map((service) => {
                        const Icon = service.icon;
                        const bgImage = categoryImages[service.category];
                        return (
                            <a
                                href={`/services/${service.slug}`}
                                class="group block relative rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-500"
                                style="aspect-ratio: 4/3;"
                            >
                                {/* Background Image */}
                                <Image
                                    src={bgImage}
                                    alt={service.name}
                                    width={600}
                                    height={450}
                                    class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                                    loading="lazy"
                                />

                                {/* Gradient Overlay */}
                                <div class="absolute inset-0 bg-gradient-to-t from-[#082a4d] via-[#082a4d]/70 to-transparent group-hover:from-[#082a4d]/90 group-hover:via-[#082a4d]/50 transition-all duration-500" />

                                {/* Content */}
                                <div class="absolute inset-0 flex flex-col justify-end p-6">
                                    {/* Icon Badge */}
                                    <div class="w-12 h-12 bg-accent rounded-lg flex items-center justify-center mb-4 shadow-lg group-hover:scale-110 transition-transform duration-300">
                                        <Icon class="w-6 h-6 text-primary" />
                                    </div>

                                    {/* Title */}
                                    <h3 class="text-xl font-bold text-white mb-3 leading-tight">
                                        {service.name}
                                    </h3>

                                    {/* CTA */}
                                    <div class="flex items-center gap-2 text-accent font-semibold text-sm group-hover:gap-3 transition-all duration-300">
                                        <span>Learn More</span>
                                        <ArrowRight class="w-4 h-4" />
                                    </div>
                                </div>

                                {/* Accent Border on Hover */}
                                <div class="absolute inset-0 border-2 border-transparent group-hover:border-accent rounded-xl transition-colors duration-300 pointer-events-none" />
                            </a>
                        );
                    })
                }
            </div>

            <div class="text-center mt-16">
                <div
                    class="text-center"
                    style="margin-top: var(--spacing-3xl);"
                >
                    <Button
                        href="/services"
                        size="lg"
                        class="text-xl font-black gap-2 magnetic-cta"
                    >
                        <Grid class="w-5 h-5" />
                        View Full Service Menu
                    </Button>
                </div>
            </div>
        </Container>
    </section>

    <!-- Why Choose Solomon Electric - Story Section -->
    <section
        id="about-story"
        aria-labelledby="story-heading"
        class="bg-light relative overflow-hidden py-20 md:py-32"
    >
        <div class="absolute inset-0 opacity-5">
            <div
                class="absolute inset-0 bg-gradient-to-br from-accent to-transparent"
            >
            </div>
        </div>

        <Container class="relative z-10">
            <div
                class="grid grid-cols-1 md:grid-cols-2 items-center reveal reveal-up"
                style="gap: var(--spacing-3xl);"
            >
                <!-- Left: Image -->
                <div class="relative order-2 md:order-1">
                    <div
                        class="absolute -inset-4 border-4 border-accent z-0 translate-x-6 translate-y-6 rounded-3xl"
                    >
                    </div>
                    <Image
                        src={customerInteractionImage}
                        alt="Professional Electrician Team"
                        class="relative z-10 w-full shadow-[var(--shadow-xl)] rounded-[var(--radius-2xl)] grayscale hover:grayscale-0 transition-all duration-[var(--transition-slow)]"
                        loading="lazy"
                        widths={[400, 600, 800]}
                    />
                </div>

                <!-- Right: Content -->
                <div class="order-1 md:order-2">
                    <p
                        class="text-accent font-bold text-lg tracking-[0.2em] uppercase font-secondary"
                        style="margin-bottom: var(--spacing-md);"
                    >
                        What You Can Expect
                    </p>
                    <h2
                        id="story-heading"
                        class="text-4xl md:text-5xl font-black text-primary leading-tight uppercase"
                        style="margin-bottom: var(--spacing-xl);"
                    >
                        Safe Homes,<br />
                        <span class="text-accent">Protected Investments</span>
                    </h2>

                    <p
                        class="text-[var(--text-body)] leading-relaxed text-lg font-medium"
                        style="margin-bottom: var(--spacing-2xl);"
                    >
                        Since 2008, Solomon Electric has been more than just a
                        contractor—we've been a safety partner for over 19,400
                        residential and commercial properties. We understand the
                        unique challenges of South Florida's electrical systems,
                        from hurricane season readiness to aging panel
                        modernization. Our team brings the local expertise
                        needed to protect your investment and ensure your
                        safety.
                    </p>

                    <div class="space-y-6">
                        <div class="flex" style="gap: var(--spacing-md);">
                            <div class="flex-shrink-0">
                                <div
                                    class="w-12 h-12 bg-accent rounded-full flex items-center justify-center shadow-lg"
                                >
                                    <svg
                                        class="w-6 h-6 text-white"
                                        fill="currentColor"
                                        viewBox="0 0 20 20"
                                    >
                                        <path
                                            fill-rule="evenodd"
                                            d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                            <div>
                                <h3
                                    class="text-xl font-black text-primary uppercase"
                                    style="margin-bottom: var(--spacing-xs);"
                                >
                                    Reliable Emergency Support
                                </h3>
                                <p class="text-body font-medium">
                                    Electrical issues can happen at any time.
                                    Our team is available to handle urgent
                                    electrical needs across Miami-Dade and
                                    Broward, ensuring your safety is never
                                    compromised.
                                </p>
                            </div>
                        </div>

                        <div class="flex" style="gap: var(--spacing-md);">
                            <div class="flex-shrink-0">
                                <div
                                    class="w-12 h-12 bg-accent rounded-full flex items-center justify-center shadow-lg"
                                >
                                    <svg
                                        class="w-6 h-6 text-white"
                                        fill="currentColor"
                                        viewBox="0 0 20 20"
                                    >
                                        <path
                                            fill-rule="evenodd"
                                            d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                            <div>
                                <h3
                                    class="text-xl font-black text-primary uppercase"
                                    style="margin-bottom: var(--spacing-xs);"
                                >
                                    Transparent Communication
                                </h3>
                                <p class="text-body font-medium">
                                    We believe in clear communication. Before
                                    starting any work, we explain the issue and
                                    the necessary solution, providing a clear
                                    understanding of the project scope.
                                </p>
                            </div>
                        </div>

                        <div class="flex" style="gap: var(--spacing-md);">
                            <div class="flex-shrink-0">
                                <div
                                    class="w-12 h-12 bg-accent rounded-full flex items-center justify-center shadow-lg"
                                >
                                    <svg
                                        class="w-6 h-6 text-white"
                                        fill="currentColor"
                                        viewBox="0 0 20 20"
                                    >
                                        <path
                                            fill-rule="evenodd"
                                            d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                            <div>
                                <h3
                                    class="text-xl font-black text-primary uppercase"
                                    style="margin-bottom: var(--spacing-xs);"
                                >
                                    Extensive Experience
                                </h3>
                                <p class="text-[var(--text-body)] font-medium">
                                    With thousands of successful projects, we
                                    have a proven history of delivering safe and
                                    compliant electrical work.
                                </p>
                            </div>
                        </div>

                        <div class="flex" style="gap: var(--spacing-md);">
                            <div class="flex-shrink-0">
                                <div
                                    class="w-12 h-12 bg-accent rounded-full flex items-center justify-center shadow-lg"
                                >
                                    <svg
                                        class="w-6 h-6 text-white"
                                        fill="currentColor"
                                        viewBox="0 0 20 20"
                                    >
                                        <path
                                            fill-rule="evenodd"
                                            d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                            <div>
                                <h3
                                    class="text-xl font-black text-primary uppercase"
                                    style="margin-bottom: var(--spacing-xs);"
                                >
                                    Quality Assurance
                                </h3>
                                <p class="text-[var(--text-body)] font-medium">
                                    We stand behind the quality of our
                                    workmanship, ensuring every job meets high
                                    professional standards.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </Container>
    </section>

    <!-- FAQ Section -->
    <FAQAccordion />

    <!-- Emergency Services CTA Banner -->
    <section
        id="emergency-cta"
        aria-labelledby="emergency-heading"
        class="bg-gradient-to-r from-accent to-accent-dark py-16 md:py-24"
    >
        <Container>
            <div
                class="flex flex-col md:flex-row items-center justify-between"
                style="gap: var(--spacing-lg);"
            >
                <div class="text-center md:text-left">
                    <h3
                        id="emergency-heading"
                        class="text-3xl md:text-4xl font-black text-white uppercase"
                        style="margin-bottom: var(--spacing-xs);"
                    >
                        Need Immediate Assistance?
                    </h3>
                    <p class="text-white/90 text-lg font-bold">
                        Electrical issues like sparking outlets or burning
                        smells require professional attention. Contact us for
                        prompt service.
                    </p>
                </div>
                <CtaButton
                    action="call"
                    variant="secondary"
                    size="lg"
                    class="flex-shrink-0 shadow-2xl hover:shadow-3xl magnetic-cta"
                />
            </div>
        </Container>
    </section>

    <!-- Reviews Carousel -->
    <ReviewCarousel />

    <!-- Service Areas Map -->
    <section class="bg-white overflow-hidden" id="service-areas">
        <Container class="py-20 md:py-32">
            <ServiceAreaMap />
        </Container>
    </section>

    <!-- Stats Section -->
    <section class="bg-primary py-20 md:py-32">
        <Container>
            <div class="text-center mb-16">
                <p
                    class="text-accent font-bold text-lg tracking-[0.2em] uppercase font-secondary"
                    style="margin-bottom: var(--spacing-md);"
                >
                    Real Results
                </p>
                <h2
                    class="text-3xl md:text-5xl font-black text-white uppercase"
                >
                    South Florida <span class="text-accent">Trusts Us</span>
                </h2>
            </div>

            <div
                class="grid grid-cols-2 md:grid-cols-4 reveal reveal-up"
                style="gap: var(--spacing-lg);"
            >
                {
                    stats.map((stat) => {
                        const numericValue = parseInt(
                            stat.number.toString().replace(/[^0-9]/g, ""),
                        );
                        const suffix = stat.number.toString().includes("+")
                            ? "+"
                            : "";

                        return (
                            <div class="text-center">
                                <div
                                    class="text-4xl md:text-5xl font-black text-white stat-counter font-display"
                                    data-target={numericValue}
                                    data-suffix={suffix}
                                    style="margin-bottom: var(--spacing-sm);"
                                >
                                    0{suffix}
                                </div>
                                <div class="text-accent font-bold uppercase tracking-wider text-sm md:text-base">
                                    {stat.label}
                                </div>
                            </div>
                        );
                    })
                }
            </div>
        </Container>
    </section>

    <!-- Latest Blog Posts -->
    <LatestBlogPosts />

    <!-- Final CTA Section -->
    <section class="py-20 md:py-32 bg-white relative overflow-hidden">
        <div
            class="absolute inset-0 bg-gradient-to-br from-accent/5 to-transparent"
        >
        </div>

        <Container class="relative z-10">
            <div class="max-w-5xl mx-auto text-center">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    class="w-12 h-12 text-accent mx-auto mb-6 animate-pulse"
                >
                    <path
                        fill-rule="evenodd"
                        d="M14.615 1.595a.75.75 0 01.359.852L12.982 9.75h7.268a.75.75 0 01.548 1.262l-10.5 11.25a.75.75 0 01-1.272-.71l1.992-7.302H3.75a.75.75 0 01-.548-1.262l10.5-11.25a.75.75 0 01.913-.143z"
                        clip-rule="evenodd"></path>
                </svg>
                <h2
                    class="text-3xl md:text-5xl font-black text-primary mb-8 uppercase"
                >
                    Ready to Get Started?
                </h2>
                <p
                    class="text-lg md:text-xl text-body mb-12 leading-relaxed font-medium reveal reveal-up reveal-delay-2"
                >
                    Experience professional electrical service from licensed
                    experts. Quality workmanship backed by our satisfaction
                    guarantee.
                </p>

                <div
                    class="flex flex-col sm:flex-row gap-4 md:gap-6 justify-center reveal reveal-up reveal-delay-3"
                >
                    <CtaButton
                        action="call"
                        variant="secondary"
                        size="lg"
                        class="magnetic-cta"
                    />
                    <CtaButton
                        action="book"
                        variant="primary"
                        size="lg"
                        class="magnetic-cta"
                    />
                </div>

                <!-- Trust Badges -->
                <div class="flex flex-wrap justify-center gap-6 mt-16 text-sm">
                    <div
                        class="flex items-center gap-2 text-[var(--text-muted)]"
                    >
                        <svg
                            class="w-5 h-5 text-accent"
                            fill="currentColor"
                            viewBox="0 0 20 20"
                        >
                            <path
                                fill-rule="evenodd"
                                d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                clip-rule="evenodd"></path>
                        </svg>
                        <span class="font-bold">Licensed & Insured</span>
                    </div>
                    <div
                        class="flex items-center gap-2 text-[var(--text-muted)]"
                    >
                        <svg
                            class="w-5 h-5 text-accent"
                            fill="currentColor"
                            viewBox="0 0 20 20"
                        >
                            <path
                                fill-rule="evenodd"
                                d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                clip-rule="evenodd"></path>
                        </svg>
                        <span class="font-bold"
                            >100% Satisfaction Guaranteed</span
                        >
                    </div>
                    <div
                        class="flex items-center gap-2 text-[var(--text-muted)]"
                    >
                        <svg
                            class="w-5 h-5 text-accent"
                            fill="currentColor"
                            viewBox="0 0 20 20"
                        >
                            <path
                                d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"
                            ></path>
                        </svg>
                        <span class="font-bold">24/7 Emergency Service</span>
                    </div>
                </div>
            </div>
        </Container>
    </section>
</Layout>

<script>
    const observerOptions = {
        root: null,
        rootMargin: "0px",
        threshold: 0.1,
    };

    const animateStats = () => {
        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    const counter = entry.target as HTMLElement;
                    const target = parseInt(
                        counter.getAttribute("data-target") || "0",
                    );
                    const suffix = counter.getAttribute("data-suffix") || "";
                    const duration = 2000; // 2 seconds
                    const startTime = performance.now();

                    const updateCount = (currentTime: number) => {
                        const elapsed = currentTime - startTime;
                        const progress = Math.min(elapsed / duration, 1);

                        // Ease out quart
                        const easeOut = 1 - Math.pow(1 - progress, 4);

                        const current = Math.floor(easeOut * target);
                        counter.innerText = current.toLocaleString() + suffix;

                        if (progress < 1) {
                            requestAnimationFrame(updateCount);
                        } else {
                            counter.innerText =
                                target.toLocaleString() + suffix;
                        }
                    };

                    requestAnimationFrame(updateCount);
                    observer.unobserve(counter);
                }
            });
        }, observerOptions);

        document
            .querySelectorAll(".stat-counter")
            .forEach((el) => observer.observe(el));
    };

    // Run on load
    animateStats();

    // Run on view transitions if enabled
    document.addEventListener("astro:page-load", animateStats);
</script>
