---
import { getCollection } from "astro:content";

export const prerender = true;

import Layout from "../../layouts/Layout.astro";
import heroImage from "../../assets/images/hero.webp";
import CtaButton from "../../components/ui/CtaButton.astro";
import Container from "../../components/ui/Container.astro";
import PageHero from "../../components/PageHero.astro";
import FAQAccordion from "../../components/FAQAccordion.astro";
import ReviewCarousel from "../../components/ReviewCarousel.astro";
import DefinitionBlock from "../../components/DefinitionBlock.astro";
import { SITE_CONFIG } from "../../config/site";
import { generateBreadcrumbSchema, generateFAQSchema } from "../../utils/seo";
import {
    AlertTriangle,
    Lightbulb,
    Plug,
    Flame,
    AlertCircle,
    Home,
    Shield,
    TrendingUp,
    Zap,
    FileCheck,
    ChevronRight,
    Check,
    ArrowRight,
} from "lucide-astro";

const Icons: Record<string, any> = {
    AlertTriangle,
    Lightbulb,
    Plug,
    Flame,
    AlertCircle,
    Home,
    Shield,
    TrendingUp,
    Zap,
    FileCheck,
};

export async function getStaticPaths() {
    const services = await getCollection("services");
    return services.map((service) => ({
        params: { slug: service.id },
        props: service,
    }));
}

const service = Astro.props;
const siteUrl = SITE_CONFIG.seo.siteUrl;

// Get related services data
const allServices = await getCollection("services");
const relatedServicesData = service.data.relatedServices
    ? allServices.filter((s) =>
          service.data.relatedServices?.includes(s.data.slug),
      )
    : [];

// Get all service areas for "Areas Served" section
const allServiceAreas = await getCollection("service-areas");
const sortedAreas = [...allServiceAreas].sort((a, b) =>
    a.data.name.localeCompare(b.data.name),
);

// Generate Service Schema with AggregateRating
const serviceSchema = {
    "@context": "https://schema.org",
    "@type": "Service",
    "@id": `${siteUrl}/services/${service.id}/#service`,
    name: service.data.name,
    description: service.data.description,
    provider: {
        "@id": `${siteUrl}/#organization`,
    },
    areaServed: SITE_CONFIG.seo.schema.areaServed.map((city) => ({
        "@type": "City",
        name: city,
        containedInPlace: { "@type": "State", name: "Florida" },
    })),
    serviceType: service.data.category,
    hasOfferCatalog: {
        "@type": "OfferCatalog",
        name: service.data.name,
        itemListElement: service.data.features
            ? service.data.features.slice(0, 5).map((f: string) => ({
                  "@type": "Offer",
                  itemOffered: {
                      "@type": "Service",
                      name: f,
                  },
              }))
            : [],
    },
    image: service.data.image
        ? `${siteUrl}${typeof service.data.image === "string" ? service.data.image : service.data.image.src}`
        : undefined,
    aggregateRating: {
        "@type": "AggregateRating",
        ratingValue: SITE_CONFIG.stats.averageRating,
        reviewCount:
            parseInt(SITE_CONFIG.stats.totalReviews.replace(/[^0-9]/g, "")) ||
            1200,
        bestRating: 5,
        worstRating: 1,
    },
};

// Generate HowTo Schema from process steps
const howToSchema =
    service.data.process && service.data.process.length > 0
        ? {
              "@context": "https://schema.org",
              "@type": "HowTo",
              name: `How We Perform ${service.data.name}`,
              description: service.data.description,
              step: service.data.process.map(
                  (step: {
                      step: number;
                      title: string;
                      description: string;
                  }) => ({
                      "@type": "HowToStep",
                      position: step.step,
                      name: step.title,
                      text: step.description,
                  }),
              ),
          }
        : null;

// Generate Breadcrumb Schema
const breadcrumbSchema = generateBreadcrumbSchema(
    [
        { name: "Home", url: "/" },
        { name: "Services", url: "/services" },
        { name: service.data.name, url: `/services/${service.id}` },
    ],
    siteUrl,
);
---

<Layout
    title={`${service.data.name} Miami | 24/7 Licensed Electrician | Solomon Electric`}
    description={`Professional ${service.data.name.toLowerCase()} in Miami-Dade & Broward. Licensed #EC13012419, 24/7 emergency service, free estimates. Call (786) 833-9211 for same-day appointments!`}
    ogImage={service.data.image
        ? `${siteUrl}${typeof service.data.image === "string" ? service.data.image : service.data.image.src}`
        : `${siteUrl}/og-default.jpg`}
    ogImageAlt={`Professional ${service.data.name} by Solomon Electric - Licensed Miami Electricians`}
>
    <!-- Service Schema Markup -->
    <script
        type="application/ld+json"
        set:html={JSON.stringify(serviceSchema)}
    />

    <!-- Breadcrumb Schema -->
    <script
        type="application/ld+json"
        set:html={JSON.stringify(breadcrumbSchema)}
    />

    <!-- FAQ Schema -->
    {
        service.data.faqs && service.data.faqs.length > 0 && (
            <script
                type="application/ld+json"
                set:html={JSON.stringify(generateFAQSchema(service.data.faqs))}
            />
        )
    }

    <!-- HowTo Schema for Process Steps -->
    {
        howToSchema && (
            <script
                type="application/ld+json"
                set:html={JSON.stringify(howToSchema)}
            />
        )
    }

    <!-- Breadcrumb Navigation -->
    <nav class="breadcrumb-nav">
        <Container>
            <div class="breadcrumb-items">
                <a href="/" class="breadcrumb-link">Home</a>
                <ChevronRight class="breadcrumb-sep" />
                <a href="/services" class="breadcrumb-link">Services</a>
                <ChevronRight class="breadcrumb-sep" />
                <span class="breadcrumb-current">{service.data.name}</span>
            </div>
        </Container>
    </nav>

    <!-- Hero Section -->
    <PageHero
        title={service.data.name}
        subtitle={`Licensed Miami Electrician ‚Ä¢ #EC13012419 ‚Ä¢ 24/7 Available`}
        description={service.data.description}
        image={service.data.image || heroImage}
        trustIndicators={true}
    />

    <!-- Definition Block for Featured Snippets -->
    <section class="py-8 md:py-12 bg-light">
        <Container>
            <DefinitionBlock
                term={service.data.name}
                definition={`is a professional electrical service that ${service.data.description.toLowerCase().replace(/^[a-z]/, (c: string) => c.toLowerCase())} Our licensed electricians in Miami-Dade and Broward counties provide expert ${service.data.name.toLowerCase()} with guaranteed satisfaction.`}
                relatedTerms={service.data.relatedServices?.slice(0, 3) || []}
            />
        </Container>
    </section>

    <!-- Stats Bar -->
    {
        service.data.stats && service.data.stats.length > 0 && (
            <section class="stats-bar">
                <Container>
                    <div class="stats-grid">
                        {service.data.stats.map(
                            (
                                stat: { value: string; label: string },
                                index: number,
                            ) => {
                                // Check if value is a simple number with optional trailing suffix (like "15+", "2,500+", "100%")
                                const simpleMatch =
                                    stat.value.match(/^([0-9,]+)([+%]?)$/);
                                const isAnimatable = simpleMatch !== null;
                                const numericValue = isAnimatable
                                    ? parseInt(simpleMatch[1].replace(/,/g, ""))
                                    : 0;
                                const suffix = isAnimatable
                                    ? simpleMatch[2]
                                    : "";

                                return (
                                    <div class="stat-item">
                                        <div class="stat-glow" />
                                        {isAnimatable ? (
                                            <span
                                                class="stat-value stat-counter"
                                                data-target={numericValue}
                                                data-suffix={suffix}
                                            >
                                                0{suffix}
                                            </span>
                                        ) : (
                                            <span class="stat-value">
                                                {stat.value}
                                            </span>
                                        )}
                                        <span class="stat-label">
                                            {stat.label}
                                        </span>
                                        {index <
                                            (service.data.stats?.length || 0) -
                                                1 && (
                                            <div class="stat-divider" />
                                        )}
                                    </div>
                                );
                            },
                        )}
                    </div>
                </Container>
            </section>
        )
    }

    <!-- Problem Identification Section -->
    {
        service.data.problems && service.data.problems.length > 0 && (
            <section class="problems-section">
                <div class="problems-bg">
                    <div class="problems-decoration-1" />
                    <div class="problems-decoration-2" />
                </div>
                <Container class="relative z-10">
                    <header class="section-header reveal reveal-up">
                        <span class="section-label">‚ö° Identify the Signs</span>
                        <h2 class="section-title">
                            {service.data.warningSignsHeading ||
                                `Warning Signs You Need ${service.data.name}`}
                        </h2>
                        {service.data.warningSignsSubheading && (
                            <p class="section-description">
                                {service.data.warningSignsSubheading}
                            </p>
                        )}
                    </header>

                    <div class="problems-grid reveal reveal-up">
                        {service.data.problems.map(
                            (
                                problem: {
                                    title: string;
                                    description: string;
                                    icon?: string;
                                },
                                index: number,
                            ) => {
                                const ProblemIcon =
                                    Icons[problem.icon || "AlertTriangle"];
                                return (
                                    <div
                                        class="problem-card glass-bg glass-border"
                                        style={`--delay: ${index * 0.1}s`}
                                    >
                                        <div class="problem-accent" />
                                        <div class="problem-glow" />
                                        <div class="problem-content">
                                            <div class="problem-icon">
                                                <ProblemIcon
                                                    strokeWidth={1.5}
                                                />
                                            </div>
                                            <h3 class="problem-title">
                                                {problem.title}
                                            </h3>
                                            <p class="problem-description">
                                                {problem.description}
                                            </p>
                                        </div>
                                    </div>
                                );
                            },
                        )}
                    </div>

                    <div class="section-cta">
                        <CtaButton
                            action="book"
                            variant="primary"
                            size="lg"
                            class="magnetic-cta"
                            text="Get Free Assessment"
                        />
                    </div>
                </Container>
            </section>
        )
    }

    <!-- Process Section -->
    {
        service.data.process && service.data.process.length > 0 && (
            <section class="process-section">
                <Container>
                    <header class="section-header reveal reveal-up">
                        <span class="section-label">üîß How We Work</span>
                        <h2 class="section-title">
                            {service.data.processHeading ||
                                `Our ${service.data.name} Process`}
                        </h2>
                    </header>

                    <div class="process-timeline reveal reveal-up">
                        {service.data.process.map(
                            (
                                step: {
                                    step: number;
                                    title: string;
                                    description: string;
                                },
                                index: number,
                            ) => (
                                <div
                                    class="process-step"
                                    style={`--delay: ${index * 0.15}s`}
                                >
                                    <div class="step-indicator">
                                        <div class="step-number-ring">
                                            <span class="step-number">
                                                {step.step}
                                            </span>
                                        </div>
                                        {index <
                                            (service.data.process?.length ||
                                                0) -
                                                1 && (
                                            <div class="step-connector-line" />
                                        )}
                                    </div>
                                    <div class="step-card glass-bg glass-border">
                                        <div class="step-card-accent" />
                                        <h3 class="step-title">{step.title}</h3>
                                        <p class="step-description">
                                            {step.description}
                                        </p>
                                    </div>
                                </div>
                            ),
                        )}
                    </div>
                </Container>
            </section>
        )
    }

    <!-- Benefits Section -->
    {
        service.data.benefits && service.data.benefits.length > 0 && (
            <section class="benefits-section">
                <div class="benefits-bg">
                    <div class="benefits-pattern" />
                </div>
                <Container class="relative z-10">
                    <header class="section-header section-header-light reveal reveal-up">
                        <span class="section-label section-label-light">
                            ‚úì Why Choose Us
                        </span>
                        <h2 class="section-title section-title-light">
                            {service.data.benefitsHeading ||
                                `Benefits of Professional ${service.data.name}`}
                        </h2>
                    </header>

                    <div class="benefits-grid reveal reveal-up">
                        {service.data.benefits.map(
                            (
                                benefit: {
                                    title: string;
                                    description: string;
                                    icon?: string;
                                },
                                index: number,
                            ) => {
                                const BenefitIcon =
                                    Icons[benefit.icon || "Zap"];
                                const isFilled = benefit.icon === "Zap";
                                return (
                                    <div
                                        class="benefit-card glass-bg glass-border"
                                        style={`--delay: ${index * 0.1}s`}
                                    >
                                        <div class="benefit-icon-wrapper">
                                            <div class="benefit-icon-bg" />
                                            <div class="benefit-icon">
                                                <BenefitIcon
                                                    strokeWidth={1.5}
                                                    fill={
                                                        isFilled
                                                            ? "currentColor"
                                                            : "none"
                                                    }
                                                />
                                            </div>
                                        </div>
                                        <h3 class="benefit-title">
                                            {benefit.title}
                                        </h3>
                                        <p class="benefit-description">
                                            {benefit.description}
                                        </p>
                                    </div>
                                );
                            },
                        )}
                    </div>
                </Container>
            </section>
        )
    }

    <!-- Features Fallback -->
    {
        (!service.data.benefits || service.data.benefits.length === 0) && (
            <section class="features-section">
                <Container>
                    <div class="features-card">
                        <div class="features-accent" />
                        <h2 class="features-title">What's Included</h2>
                        <ul class="features-list">
                            {service.data.features.map((feature: string) => (
                                <li class="feature-item">
                                    <div class="feature-check">
                                        <Check strokeWidth={3} />
                                    </div>
                                    <span>{feature}</span>
                                </li>
                            ))}
                        </ul>
                    </div>
                </Container>
            </section>
        )
    }

    <!-- SEO Content -->
    {
        service.data.seoContent && service.data.seoContent.length > 0 && (
            <section class="seo-section">
                <Container>
                    <div class="seo-wrapper">
                        {service.data.seoContent.map(
                            (content: { heading: string; body: string }) => (
                                <article class="seo-block">
                                    <h2 class="seo-heading">
                                        {content.heading}
                                    </h2>
                                    <p class="seo-body">{content.body}</p>
                                </article>
                            ),
                        )}
                    </div>
                </Container>
            </section>
        )
    }

    <!-- FAQs Section - Uses FAQAccordion which has its own section wrapper -->
    {
        service.data.faqs && service.data.faqs.length > 0 && (
            <FAQAccordion
                faqs={service.data.faqs.map(
                    (f: { question: string; answer: string }, i: number) => ({
                        id: `faq-${i}`,
                        question: f.question,
                        answer: f.answer,
                        category: service.data.category,
                    }),
                )}
            />
        )
    }

    <!-- Customer Reviews Section -->
    <ReviewCarousel />

    <!-- Related Services -->
    {
        relatedServicesData.length > 0 && (
            <section class="related-section">
                <Container>
                    <header class="section-header reveal reveal-up">
                        <span class="section-label">üîå Explore More</span>
                        <h2 class="section-title">
                            Related <span class="text-accent">Services</span>
                        </h2>
                    </header>

                    <div class="related-grid reveal reveal-up">
                        {relatedServicesData
                            .slice(0, 4)
                            .map((related, index: number) => (
                                <a
                                    href={`/services/${related.data.slug}`}
                                    class="related-card glass-bg glass-border"
                                    style={`--delay: ${index * 0.1}s`}
                                >
                                    <div class="related-card-accent" />
                                    <div class="related-card-glow" />
                                    <div class="related-icon">
                                        <Zap class="w-full h-full" />
                                    </div>
                                    <h3 class="related-title">
                                        {related.data.name}
                                    </h3>
                                    <p class="related-description">
                                        {related.data.shortDescription}
                                    </p>
                                    <span class="related-link">
                                        Learn More
                                        <ArrowRight />
                                    </span>
                                </a>
                            ))}
                    </div>
                </Container>
            </section>
        )
    }

    <!-- Service Areas Section -->
    <section class="service-areas-section">
        <Container>
            <header class="section-header reveal reveal-up">
                <span class="section-label">üìç Serving Your Local Area</span>
                <h2 class="section-title">
                    Professional {service.data.name} in <span
                        class="text-accent">South Florida</span
                    >
                </h2>
                <p class="section-description">
                    Solomon Electric provides {service.data.name.toLowerCase()} for
                    residential and commercial customers across Miami-Dade and Broward
                    counties. Click your city to see local pricing, projects, and
                    FAQs.
                </p>
            </header>

            <div class="areas-grid reveal reveal-up">
                {
                    sortedAreas.map((area, index) => (
                        <a
                            href={`/services/${service.id}/${area.id}`}
                            class="area-link-card glass-bg glass-border"
                            style={`--delay: ${index * 0.05}s`}
                        >
                            <span class="area-name">{area.data.name}</span>
                            <ArrowRight class="area-arrow" />
                        </a>
                    ))
                }
            </div>

            <div class="all-areas-cta">
                <p class="text-center text-white/80 mb-4">
                    Available in all 27 South Florida cities
                </p>
            </div>
        </Container>
    </section>

    <!-- Final CTA Section -->
    <section class="final-cta">
        <div class="final-cta-bg">
            <div class="cta-bolt-decoration cta-bolt-1">
                <Zap />
            </div>
            <div class="cta-bolt-decoration cta-bolt-2">
                <Zap />
            </div>
        </div>
        <Container class="relative z-10">
            <div class="final-cta-content">
                <div class="cta-icon-wrapper">
                    <Zap class="cta-icon" fill="currentColor" />
                </div>
                <h2 class="cta-title reveal reveal-up">
                    Ready to Get Started?
                </h2>
                <p class="cta-description reveal reveal-up reveal-delay-1">
                    Contact Solomon Electric today for a free consultation. Our
                    licensed electricians are ready to help with your {
                        service.data.name.toLowerCase()
                    } needs in South Florida.
                </p>
                <div class="cta-buttons reveal reveal-up reveal-delay-2">
                    <CtaButton
                        action="book"
                        variant="primary"
                        size="lg"
                        class="magnetic-cta"
                        text="Get Free Estimate"
                    />
                    <CtaButton
                        action="call"
                        variant="secondary"
                        size="lg"
                        class="magnetic-cta"
                        text="Call Now"
                    />
                </div>
            </div>
        </Container>
    </section>
</Layout>

<style>
    /* =========================================
       BREADCRUMB NAVIGATION
       ========================================= */
    .breadcrumb-nav {
        background: rgba(243, 243, 243, 0.9);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        padding: 0.75rem 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        position: sticky;
        top: var(--header-height, 70px);
        z-index: 45;
    }

    .breadcrumb-items {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
    }

    .breadcrumb-link {
        color: var(--text-body);
        text-decoration: none;
        font-weight: 500;
        transition: color var(--transition-fast);
    }

    .breadcrumb-link:hover {
        color: var(--color-accent);
    }

    .breadcrumb-sep {
        width: 1rem;
        height: 1rem;
        color: var(--text-muted);
    }

    .breadcrumb-current {
        color: var(--color-primary);
        font-weight: 700;
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* =========================================
       STATS BAR - Electric energy feel
       ========================================= */
    .stats-bar {
        background: linear-gradient(
            135deg,
            var(--color-primary) 0%,
            #061f3d 100%
        );
        padding: clamp(1.5rem, 3vw, 2.5rem) 0;
        position: relative;
        overflow: hidden;
    }

    .stats-bar::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
            90deg,
            transparent 0%,
            rgba(20, 211, 227, 0.1) 50%,
            transparent 100%
        );
        animation: shimmer 3s ease-in-out infinite;
    }

    @keyframes shimmer {
        0%,
        100% {
            transform: translateX(-100%);
        }
        50% {
            transform: translateX(100%);
        }
    }

    .stats-grid {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: clamp(2rem, 4vw, 4rem);
        position: relative;
    }

    .stat-item {
        position: relative;
        text-align: center;
        padding: 0 clamp(1rem, 2vw, 2rem);
    }

    .stat-glow {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80px;
        height: 80px;
        background: radial-gradient(
            circle,
            rgba(20, 211, 227, 0.3) 0%,
            transparent 70%
        );
        filter: blur(20px);
        opacity: 0;
        transition: opacity var(--transition-base);
    }

    .stat-item:hover .stat-glow {
        opacity: 1;
    }

    .stat-value {
        display: block;
        font-family: var(--font-display);
        font-size: clamp(2rem, 5vw, 3rem);
        font-weight: 800;
        color: var(--color-accent);
        line-height: 1;
        text-shadow: 0 0 30px rgba(20, 211, 227, 0.5);
        position: relative;
    }

    .stat-label {
        display: block;
        font-size: clamp(0.7rem, 1vw, 0.8rem);
        color: rgba(255, 255, 255, 0.85);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-weight: 600;
        margin-top: 0.5rem;
    }

    .stat-divider {
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 1px;
        height: 40px;
        background: linear-gradient(
            180deg,
            transparent 0%,
            var(--color-accent) 50%,
            transparent 100%
        );
    }

    /* =========================================
       SECTION HEADERS
       ========================================= */
    .section-header {
        text-align: center;
        margin-bottom: clamp(2.5rem, 5vw, 4rem);
    }

    .section-label {
        display: inline-block;
        color: var(--color-accent);
        font-size: clamp(0.8rem, 1vw, 0.9rem);
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        margin-bottom: clamp(0.75rem, 1.5vw, 1rem);
        padding: 0.5rem 1rem;
        background: rgba(20, 211, 227, 0.1);
        border-radius: var(--radius-full);
    }

    .section-label-light {
        color: white;
        background: rgba(255, 255, 255, 0.15);
    }

    .section-title {
        font-size: clamp(1.75rem, 4vw, 2.75rem);
        font-weight: 800;
        color: var(--color-primary);
        margin-bottom: clamp(0.75rem, 1.5vw, 1rem);
        text-transform: uppercase;
        line-height: 1.15;
    }

    .section-title-light {
        color: white;
    }

    .section-description {
        font-size: clamp(1rem, 1.25vw, 1.125rem);
        color: var(--text-body);
        max-width: 900px;
        margin: 0 auto;
        line-height: 1.7;
    }

    .section-cta {
        text-align: center;
        margin-top: clamp(2.5rem, 5vw, 4rem);
    }

    /* =========================================
       PROBLEMS SECTION - Warning cards
       ========================================= */
    .problems-section {
        position: relative;
        overflow: hidden;
        background: var(--bg-body);
        padding: clamp(4rem, 8vw, 6rem) 0;
    }

    .problems-bg {
        position: absolute;
        inset: 0;
        pointer-events: none;
    }

    .problems-decoration-1 {
        position: absolute;
        top: -100px;
        right: -100px;
        width: 400px;
        height: 400px;
        background: radial-gradient(
            circle,
            rgba(20, 211, 227, 0.08) 0%,
            transparent 60%
        );
        transform: rotate(45deg);
    }

    .problems-decoration-2 {
        position: absolute;
        bottom: -100px;
        left: -100px;
        width: 300px;
        height: 300px;
        background: radial-gradient(
            circle,
            rgba(13, 67, 128, 0.08) 0%,
            transparent 60%
        );
    }

    .problems-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: clamp(1.5rem, 3vw, 2rem);
        max-width: 1100px;
        margin: 0 auto;
    }

    @media (max-width: 900px) {
        .problems-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 600px) {
        .problems-grid {
            grid-template-columns: 1fr;
        }
    }

    .problem-card {
        position: relative;
        background: var(--bg-surface);
        overflow: hidden;
        box-shadow: var(--shadow-md);
        transition: all var(--transition-base);
        animation: fadeInUp 0.6s ease-out backwards;
        animation-delay: var(--delay);
        /* Slanted parallelogram corners like CTAs */
        clip-path: polygon(16px 0%, 100% 0%, calc(100% - 16px) 100%, 0% 100%);
    }

    .problem-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow:
            var(--shadow-xl),
            0 0 40px rgba(20, 211, 227, 0.15);
    }

    .problem-accent {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(
            90deg,
            var(--color-accent),
            var(--color-primary)
        );
    }

    .problem-glow {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            135deg,
            rgba(20, 211, 227, 0.05) 0%,
            transparent 50%
        );
        opacity: 0;
        transition: opacity var(--transition-base);
    }

    .problem-card:hover .problem-glow {
        opacity: 1;
    }

    .problem-content {
        position: relative;
        padding: clamp(1.5rem, 3vw, 2rem);
    }

    .problem-icon {
        width: clamp(3rem, 5vw, 3.5rem);
        height: clamp(3rem, 5vw, 3.5rem);
        background: linear-gradient(
            135deg,
            rgba(20, 211, 227, 0.15) 0%,
            rgba(20, 211, 227, 0.05) 100%
        );
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1.25rem;
        position: relative;
    }

    .problem-icon::before {
        content: "";
        position: absolute;
        inset: -2px;
        border-radius: inherit;
        background: linear-gradient(
            135deg,
            var(--color-accent) 0%,
            transparent 50%
        );
        opacity: 0;
        transition: opacity var(--transition-fast);
        z-index: -1;
    }

    .problem-card:hover .problem-icon::before {
        opacity: 1;
    }

    .problem-icon svg {
        width: clamp(1.5rem, 2.5vw, 1.75rem);
        height: clamp(1.5rem, 2.5vw, 1.75rem);
        color: var(--color-accent);
    }

    .problem-title {
        font-size: clamp(1rem, 1.25vw, 1.125rem);
        font-weight: 700;
        color: var(--color-primary);
        margin-bottom: 0.75rem;
        text-transform: uppercase;
        line-height: 1.3;
    }

    .problem-description {
        font-size: clamp(0.875rem, 1vw, 0.9375rem);
        color: var(--text-body);
        line-height: 1.7;
        margin: 0;
    }

    /* =========================================
       PROCESS SECTION - Timeline
       ========================================= */
    .process-section {
        background: linear-gradient(
            180deg,
            var(--bg-surface) 0%,
            var(--bg-body) 100%
        );
        padding: clamp(4rem, 8vw, 6rem) 0;
    }

    .process-timeline {
        max-width: 1100px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 0;
    }

    .process-step {
        display: flex;
        gap: clamp(1.5rem, 3vw, 2.5rem);
        animation: fadeInUp 0.6s ease-out backwards;
        animation-delay: var(--delay);
    }

    .step-indicator {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex-shrink: 0;
    }

    .step-number-ring {
        width: clamp(3.5rem, 6vw, 4.5rem);
        height: clamp(3.5rem, 6vw, 4.5rem);
        border-radius: var(--radius-full);
        background: linear-gradient(
            135deg,
            var(--color-accent) 0%,
            var(--color-accent-dark) 100%
        );
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 20px rgba(20, 211, 227, 0.4);
        position: relative;
    }

    .step-number-ring::before {
        content: "";
        position: absolute;
        inset: -4px;
        border-radius: var(--radius-full);
        background: linear-gradient(
            135deg,
            rgba(20, 211, 227, 0.3) 0%,
            transparent 50%
        );
        z-index: -1;
    }

    .step-number {
        font-family: var(--font-display);
        font-size: clamp(1.25rem, 2vw, 1.5rem);
        font-weight: 800;
        color: white;
    }

    .step-connector-line {
        width: 3px;
        flex: 1;
        min-height: 60px;
        background: linear-gradient(
            180deg,
            var(--color-accent) 0%,
            var(--border-light) 100%
        );
        margin: 0.5rem 0;
    }

    .step-card {
        flex: 1;
        position: relative;
        background: var(--bg-surface);
        padding: clamp(1.5rem, 3vw, 2rem);
        box-shadow: var(--shadow-sm);
        margin-bottom: clamp(1rem, 2vw, 1.5rem);
        transition: all var(--transition-base);
        overflow: hidden;
        /* Slanted parallelogram corners like CTAs */
        clip-path: polygon(12px 0%, 100% 0%, calc(100% - 12px) 100%, 0% 100%);
    }

    .step-card:hover {
        box-shadow: var(--shadow-lg);
        transform: translateX(8px);
    }

    .step-card-accent {
        position: absolute;
        left: 0;
        top: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(
            180deg,
            var(--color-accent) 0%,
            var(--color-primary) 100%
        );
    }

    .step-title {
        font-size: clamp(1.125rem, 1.5vw, 1.25rem);
        font-weight: 700;
        color: var(--color-primary);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
    }

    .step-description {
        font-size: clamp(0.9rem, 1.1vw, 1rem);
        color: var(--text-body);
        line-height: 1.7;
        margin: 0;
    }

    /* =========================================
       BENEFITS SECTION - Dark premium look
       ========================================= */
    .benefits-section {
        position: relative;
        padding: clamp(4rem, 8vw, 6rem) 0;
        overflow: hidden;
    }

    .benefits-bg {
        position: absolute;
        inset: 0;
        background: linear-gradient(
            135deg,
            var(--color-primary) 0%,
            #061f3d 100%
        );
    }

    .benefits-pattern {
        position: absolute;
        inset: 0;
        background-image:
            radial-gradient(
                circle at 20% 80%,
                rgba(20, 211, 227, 0.15) 0%,
                transparent 40%
            ),
            radial-gradient(
                circle at 80% 20%,
                rgba(20, 211, 227, 0.1) 0%,
                transparent 40%
            );
    }

    .benefits-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: clamp(1.5rem, 3vw, 2rem);
    }

    .benefit-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: clamp(2rem, 4vw, 2.5rem);
        text-align: center;
        transition: all var(--transition-base);
        animation: fadeInUp 0.6s ease-out backwards;
        animation-delay: var(--delay);
        /* Slanted parallelogram corners like CTAs */
        clip-path: polygon(16px 0%, 100% 0%, calc(100% - 16px) 100%, 0% 100%);
    }

    .benefit-card:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(20, 211, 227, 0.5);
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    .benefit-icon-wrapper {
        position: relative;
        display: inline-block;
        margin-bottom: 1.5rem;
    }

    .benefit-icon-bg {
        position: absolute;
        inset: -8px;
        background: radial-gradient(
            circle,
            rgba(20, 211, 227, 0.3) 0%,
            transparent 70%
        );
        filter: blur(15px);
        opacity: 0;
        transition: opacity var(--transition-base);
    }

    .benefit-card:hover .benefit-icon-bg {
        opacity: 1;
    }

    .benefit-icon {
        width: clamp(3.5rem, 6vw, 4.5rem);
        height: clamp(3.5rem, 6vw, 4.5rem);
        background: linear-gradient(
            135deg,
            rgba(20, 211, 227, 0.2) 0%,
            rgba(20, 211, 227, 0.05) 100%
        );
        border: 2px solid rgba(20, 211, 227, 0.3);
        border-radius: var(--radius-xl);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    .benefit-icon svg {
        width: clamp(1.75rem, 3vw, 2.25rem);
        height: clamp(1.75rem, 3vw, 2.25rem);
        color: var(--color-accent);
    }

    .benefit-title {
        font-size: clamp(1rem, 1.25vw, 1.125rem);
        font-weight: 700;
        color: white;
        margin-bottom: 0.75rem;
        text-transform: uppercase;
    }

    .benefit-description {
        font-size: clamp(0.875rem, 1vw, 0.9375rem);
        color: rgba(255, 255, 255, 0.8);
        line-height: 1.7;
        margin: 0;
    }

    /* =========================================
       FEATURES FALLBACK
       ========================================= */
    .features-section {
        background: var(--bg-body);
        padding: clamp(4rem, 8vw, 6rem) 0;
    }

    .features-card {
        position: relative;
        background: var(--bg-surface);
        box-shadow: var(--shadow-md);
        padding: clamp(2rem, 4vw, 3rem);
        max-width: 800px;
        margin: 0 auto;
        overflow: hidden;
        /* Slanted parallelogram corners like CTAs */
        clip-path: polygon(20px 0%, 100% 0%, calc(100% - 20px) 100%, 0% 100%);
    }

    .features-accent {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(
            90deg,
            var(--color-accent),
            var(--color-primary)
        );
    }

    .features-title {
        font-size: clamp(1.5rem, 3vw, 2rem);
        font-weight: 800;
        color: var(--color-primary);
        text-transform: uppercase;
        margin-bottom: 2rem;
    }

    .features-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        gap: 1rem;
    }

    .feature-item {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
    }

    .feature-check {
        flex-shrink: 0;
        width: 1.75rem;
        height: 1.75rem;
        background: linear-gradient(
            135deg,
            var(--color-accent) 0%,
            var(--color-accent-dark) 100%
        );
        border-radius: var(--radius-full);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .feature-check svg {
        width: 1rem;
        height: 1rem;
        color: white;
    }

    .feature-item span {
        font-size: clamp(1rem, 1.25vw, 1.125rem);
        color: var(--text-body);
        font-weight: 500;
        line-height: 1.5;
        padding-top: 0.125rem;
    }

    /* =========================================
       SEO CONTENT
       ========================================= */
    .seo-section {
        background: var(--bg-surface);
        padding: clamp(4rem, 8vw, 6rem) 0;
    }

    .seo-wrapper {
        max-width: 800px;
        margin: 0 auto;
    }

    .seo-block {
        margin-bottom: clamp(2.5rem, 5vw, 3.5rem);
    }

    .seo-block:last-child {
        margin-bottom: 0;
    }

    .seo-heading {
        font-size: clamp(1.25rem, 2vw, 1.5rem);
        font-weight: 700;
        color: var(--color-primary);
        margin-bottom: 1rem;
        text-transform: uppercase;
        position: relative;
        padding-left: 1rem;
    }

    .seo-heading::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        width: 4px;
        height: 100%;
        background: var(--color-accent);
        border-radius: 2px;
    }

    .seo-body {
        font-size: clamp(1rem, 1.15vw, 1.0625rem);
        color: var(--text-body);
        line-height: 1.8;
        margin: 0;
    }

    /* =========================================
       SERVICE AREAS SECTION
       ========================================= */
    .service-areas-section {
        background: linear-gradient(
            180deg,
            var(--bg-body) 0%,
            var(--bg-surface) 100%
        );
        padding: clamp(4rem, 8vw, 6rem) 0;
    }

    .areas-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: clamp(0.75rem, 1.5vw, 1rem);
        margin-bottom: clamp(2rem, 4vw, 3rem);
    }

    .area-link-card {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: clamp(0.875rem, 1.5vw, 1rem) clamp(1rem, 2vw, 1.25rem);
        background: var(--bg-surface);
        border: 1px solid var(--border-light);
        text-decoration: none;
        overflow: hidden;
        transition: all var(--transition-base);
        animation: fadeInUp 0.4s ease-out backwards;
        animation-delay: var(--delay);
        clip-path: polygon(10px 0%, 100% 0%, calc(100% - 10px) 100%, 0% 100%);
    }

    .area-link-card:hover {
        border-color: var(--color-accent);
        background: linear-gradient(
            135deg,
            rgba(20, 211, 227, 0.08) 0%,
            var(--bg-surface) 100%
        );
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(20, 211, 227, 0.15);
    }

    .area-name {
        font-size: clamp(0.85rem, 1vw, 0.9375rem);
        font-weight: 600;
        color: var(--color-primary);
        transition: color var(--transition-fast);
    }

    .area-link-card:hover .area-name {
        color: var(--color-accent);
    }

    .area-arrow {
        width: 1rem;
        height: 1rem;
        color: var(--text-muted);
        transition: all var(--transition-fast);
        flex-shrink: 0;
    }

    .area-link-card:hover .area-arrow {
        color: var(--color-accent);
        transform: translateX(4px);
    }

    .all-areas-cta {
        text-align: center;
        margin-top: clamp(1.5rem, 3vw, 2rem);
    }

    @media (max-width: 768px) {
        .areas-grid {
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        }
    }

    @media (max-width: 480px) {
        .areas-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    /* =========================================
       RELATED SERVICES
       ========================================= */
    .related-section {
        background: linear-gradient(
            180deg,
            var(--bg-surface) 0%,
            var(--bg-body) 100%
        );
        padding: clamp(4rem, 8vw, 6rem) 0;
    }

    .related-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: clamp(1.5rem, 3vw, 2rem);
    }

    .related-card {
        position: relative;
        background: var(--bg-surface);
        padding: clamp(1.5rem, 3vw, 2rem);
        text-decoration: none;
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border-light);
        transition: all var(--transition-base);
        animation: fadeInUp 0.6s ease-out backwards;
        animation-delay: var(--delay);
        /* Slanted parallelogram corners like CTAs */
        clip-path: polygon(14px 0%, 100% 0%, calc(100% - 14px) 100%, 0% 100%);
    }

    .related-card:hover {
        border-color: var(--color-accent);
        transform: translateY(-8px);
        box-shadow:
            var(--shadow-xl),
            0 0 40px rgba(20, 211, 227, 0.1);
    }

    .related-card-accent {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(
            90deg,
            var(--color-accent),
            var(--color-primary)
        );
        transform: scaleX(0);
        transform-origin: left;
        transition: transform var(--transition-base);
    }

    .related-card:hover .related-card-accent {
        transform: scaleX(1);
    }

    .related-card-glow {
        position: absolute;
        inset: 0;
        background: radial-gradient(
            circle at top right,
            rgba(20, 211, 227, 0.1) 0%,
            transparent 50%
        );
        opacity: 0;
        transition: opacity var(--transition-base);
    }

    .related-card:hover .related-card-glow {
        opacity: 1;
    }

    .related-icon {
        width: 2.5rem;
        height: 2.5rem;
        background: linear-gradient(
            135deg,
            rgba(20, 211, 227, 0.15) 0%,
            rgba(20, 211, 227, 0.05) 100%
        );
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
    }

    .related-icon svg {
        width: 1.25rem;
        height: 1.25rem;
        color: var(--color-accent);
    }

    .related-title {
        font-size: clamp(0.95rem, 1.1vw, 1rem);
        font-weight: 700;
        color: var(--color-primary);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        line-height: 1.3;
    }

    .related-description {
        font-size: clamp(0.8rem, 0.9vw, 0.875rem);
        color: var(--text-body);
        line-height: 1.6;
        margin-bottom: 1rem;
    }

    .related-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        font-weight: 700;
        color: var(--color-accent);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .related-link svg {
        width: 1rem;
        height: 1rem;
        transition: transform var(--transition-fast);
    }

    .related-card:hover .related-link {
        color: var(--color-primary);
    }

    .related-card:hover .related-link svg {
        transform: translateX(4px);
    }

    /* =========================================
       FINAL CTA
       ========================================= */
    .final-cta {
        position: relative;
        background: linear-gradient(
            135deg,
            var(--color-primary) 0%,
            #061f3d 100%
        );
        padding: clamp(4rem, 8vw, 6rem) 0;
        overflow: hidden;
    }

    .final-cta-bg {
        position: absolute;
        inset: 0;
        pointer-events: none;
    }

    .cta-bolt-decoration {
        position: absolute;
        color: rgba(20, 211, 227, 0.1);
    }

    .cta-bolt-1 {
        width: 200px;
        height: 200px;
        top: -50px;
        left: 10%;
        transform: rotate(-15deg);
    }

    .cta-bolt-2 {
        width: 150px;
        height: 150px;
        bottom: -30px;
        right: 15%;
        transform: rotate(15deg);
    }

    .final-cta-content {
        text-align: center;
        max-width: 900px;
        margin: 0 auto;
    }

    .cta-icon-wrapper {
        position: relative;
        display: inline-block;
        margin-bottom: 1.5rem;
    }

    .cta-icon-wrapper::before {
        content: "";
        position: absolute;
        inset: -15px;
        background: radial-gradient(
            circle,
            rgba(20, 211, 227, 0.4) 0%,
            transparent 70%
        );
        filter: blur(20px);
        animation: pulse 2s ease-in-out infinite;
    }

    .cta-icon {
        width: clamp(3rem, 6vw, 4rem);
        height: clamp(3rem, 6vw, 4rem);
        color: var(--color-accent);
        position: relative;
        animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
        0%,
        100% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-10px);
        }
    }

    .cta-title {
        color: white;
        font-size: clamp(1.75rem, 4vw, 2.75rem);
        font-weight: 800;
        text-transform: uppercase;
        margin-bottom: clamp(0.75rem, 1.5vw, 1rem);
    }

    .cta-description {
        color: rgba(255, 255, 255, 0.9);
        font-size: clamp(1rem, 1.25vw, 1.125rem);
        line-height: 1.7;
        margin-bottom: clamp(2rem, 4vw, 2.5rem);
    }

    .cta-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: clamp(1rem, 2vw, 1.25rem);
        justify-content: center;
    }

    /* =========================================
       ANIMATIONS
       ========================================= */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes pulse {
        0%,
        100% {
            transform: scale(1);
            opacity: 1;
        }
        50% {
            transform: scale(1.1);
            opacity: 0.7;
        }
    }

    /* =========================================
       RESPONSIVE
       ========================================= */
    @media (max-width: 768px) {
        .stats-grid {
            gap: 1.5rem;
        }

        .stat-divider {
            display: none;
        }

        .process-step {
            flex-direction: column;
        }

        .step-connector-line {
            display: none;
        }

        .step-card {
            margin-bottom: 1rem;
        }
    }
</style>

<script>
    // Stats Counter Animation
    function animateStats() {
        const observerOptions = {
            root: null,
            rootMargin: "0px",
            threshold: 0.3,
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    const counter = entry.target as HTMLElement;
                    const target = parseInt(
                        counter.getAttribute("data-target") || "0",
                    );
                    const suffix = counter.getAttribute("data-suffix") || "";
                    const duration = 2000;
                    const startTime = performance.now();

                    const updateCount = (currentTime: number) => {
                        const elapsed = currentTime - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        const easeOut = 1 - Math.pow(1 - progress, 3);
                        const current = Math.floor(easeOut * target);
                        counter.innerText = current.toLocaleString() + suffix;

                        if (progress < 1) {
                            requestAnimationFrame(updateCount);
                        } else {
                            counter.innerText =
                                target.toLocaleString() + suffix;
                        }
                    };

                    requestAnimationFrame(updateCount);
                    observer.unobserve(counter);
                }
            });
        }, observerOptions);

        document
            .querySelectorAll(".stat-counter")
            .forEach((el) => observer.observe(el));
    }

    // Run on load
    animateStats();

    // Run on view transitions if enabled
    document.addEventListener("astro:page-load", animateStats);

    // Set header height for sticky breadcrumbs
    function setHeaderHeight() {
        const header = document.querySelector("header");
        if (header) {
            const height = header.offsetHeight;
            document.documentElement.style.setProperty(
                "--header-height",
                height + "px",
            );
        }
    }
    setHeaderHeight();
    window.addEventListener("resize", setHeaderHeight);
</script>
