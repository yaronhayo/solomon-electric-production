---
/**
 * CityMap Component
 * Displays a branded Google Maps embed for a specific city/service area.
 * Features Solomon Electric branding with parallelogram container,
 * accent glows, and dark theme wrapper.
 */
import { SITE_CONFIG } from "../config/site";

interface Props {
    cityName: string;
    county?: string;
    coordinates?: { lat: number; lng: number };
    zoom?: number;
}

const { cityName, coordinates: _coordinates, zoom = 13 } = Astro.props;

// Use the free Google Maps embed (no API key required)
// Format: https://www.google.com/maps/embed?pb=...
// Alternative: use the place search format
const mapQuery = encodeURIComponent(`${cityName}, Florida, USA`);

// Standard Google Maps iframe embed URL (no API key needed)
const mapEmbedUrl = `https://www.google.com/maps?q=${mapQuery}&z=${zoom}&output=embed`;
---

<section class="city-map-section">
    <div class="city-map-wrapper">
        <div class="map-decoration-1"></div>
        <div class="map-decoration-2"></div>

        <div class="map-container">
            <!-- Map Header -->
            <div class="map-header">
                <div class="map-header-content">
                    <div class="map-icon">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                        >
                            <path
                                d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"
                            ></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                    </div>
                    <div class="map-header-text">
                        <span class="map-label">Service Area</span>
                        <h3 class="map-title">{cityName}, Florida</h3>
                    </div>
                </div>
                <div class="map-stats">
                    <div class="stat">
                        <span class="stat-value">24/7</span>
                        <span class="stat-label">Response</span>
                    </div>
                    <div class="stat-divider"></div>
                    <div class="stat">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                            class="check-icon"
                        >
                            <path
                                fill-rule="evenodd"
                                d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z"
                                clip-rule="evenodd"></path>
                        </svg>
                        <span class="stat-label">Licensed</span>
                    </div>
                </div>
            </div>

            <!-- Map Embed -->
            <div class="map-frame">
                <div class="map-glow"></div>
                <iframe
                    src={mapEmbedUrl}
                    width="100%"
                    height="100%"
                    style="border:0;"
                    allowfullscreen
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade"
                    title={`Licensed Electrician in ${cityName} FL | Solomon Electric Service Area Map`}
                ></iframe>

                <!-- Branded Corner Badge -->
                <div class="map-badge">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                        class="badge-icon"
                    >
                        <path
                            fill-rule="evenodd"
                            d="M14.615 1.595a.75.75 0 01.359.852L12.982 9.75h7.268a.75.75 0 01.548 1.262l-10.5 11.25a.75.75 0 01-1.272-.71l1.992-7.302H3.75a.75.75 0 01-.548-1.262l10.5-11.25a.75.75 0 01.913-.143z"
                            clip-rule="evenodd"></path>
                    </svg>
                    <span>{SITE_CONFIG.company.name} Premium</span>
                </div>
            </div>

            <!-- Map Footer -->
            <div class="map-footer">
                <p class="map-footer-text font-secondary">
                    Professional, code-compliant electrical services throughout {
                        cityName
                    } FL.
                </p>
                <a
                    href={`https://www.google.com/maps/search/licensed+electrician+near+${mapQuery}`}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="map-link"
                >
                    <span>View on Google Maps</span>
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"
                        ></path>
                    </svg>
                </a>
            </div>
        </div>
    </div>
</section>

<style>
    /* =========================================
       CITY MAP SECTION
       ========================================= */
    .city-map-section {
        padding: 0;
        background: var(--bg-surface);
    }

    .city-map-wrapper {
        position: relative;
        width: 100%;
        max-width: none;
        margin: 0 auto;
        padding: 0;
    }

    /* Decorative Elements */
    .map-decoration-1 {
        position: absolute;
        top: -50px;
        right: -50px;
        width: 150px;
        height: 150px;
        background: radial-gradient(
            circle,
            rgba(20, 211, 227, 0.1) 0%,
            transparent 70%
        );
        border-radius: 50%;
        pointer-events: none;
    }

    .map-decoration-2 {
        position: absolute;
        bottom: -30px;
        left: -30px;
        width: 100px;
        height: 100px;
        background: radial-gradient(
            circle,
            rgba(13, 67, 128, 0.1) 0%,
            transparent 70%
        );
        border-radius: 50%;
        pointer-events: none;
    }

    /* Map Container */
    .map-container {
        position: relative;
        background: var(--bg-surface);
        box-shadow: var(--shadow-xl);
        overflow: hidden;
    }

    /* Map Header */
    .map-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 1rem;
        padding: clamp(1rem, 2vw, 1.5rem);
        background: linear-gradient(
            135deg,
            var(--color-primary) 0%,
            #061f3d 100%
        );
        border-bottom: 3px solid var(--color-accent);
    }

    .map-header-content {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .map-icon {
        width: clamp(2.5rem, 4vw, 3rem);
        height: clamp(2.5rem, 4vw, 3rem);
        background: linear-gradient(
            135deg,
            rgba(20, 211, 227, 0.2) 0%,
            rgba(20, 211, 227, 0.05) 100%
        );
        border: 2px solid rgba(20, 211, 227, 0.3);
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .map-icon svg {
        width: clamp(1.25rem, 2vw, 1.5rem);
        height: clamp(1.25rem, 2vw, 1.5rem);
        color: var(--color-accent);
    }

    .map-label {
        display: block;
        font-size: 0.7rem;
        color: var(--color-accent);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-weight: 700;
    }

    .map-title {
        font-family: var(--font-display);
        font-size: clamp(1.125rem, 2vw, 1.5rem);
        font-weight: 800;
        color: white;
        text-transform: uppercase;
        margin: 0;
        line-height: 1.2;
    }

    .map-stats {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .stat {
        display: flex;
        align-items: center;
        gap: 0.375rem;
    }

    .stat-value {
        font-family: var(--font-display);
        font-size: 1rem;
        font-weight: 800;
        color: var(--color-accent);
    }

    .stat-label {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.7);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .stat-divider {
        width: 1px;
        height: 24px;
        background: linear-gradient(
            180deg,
            transparent,
            rgba(255, 255, 255, 0.3),
            transparent
        );
    }

    .check-icon {
        width: 1.25rem;
        height: 1.25rem;
        color: var(--color-accent);
    }

    /* Map Frame */
    .map-frame {
        position: relative;
        height: clamp(300px, 50vw, 400px);
        background: #e5e7eb;
    }

    .map-glow {
        position: absolute;
        inset: 0;
        background: linear-gradient(
            135deg,
            rgba(20, 211, 227, 0.05) 0%,
            transparent 30%,
            transparent 70%,
            rgba(13, 67, 128, 0.05) 100%
        );
        pointer-events: none;
        z-index: 1;
    }

    .map-frame iframe {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
    }

    /* Branded Badge */
    .map-badge {
        position: absolute;
        bottom: 1rem;
        left: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: var(--color-primary);
        color: white;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 10;
        clip-path: polygon(8px 0, 100% 0, calc(100% - 8px) 100%, 0 100%);
    }

    .badge-icon {
        width: 1rem;
        height: 1rem;
        color: var(--color-accent);
    }

    /* Map Footer */
    .map-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 1rem;
        padding: clamp(1rem, 2vw, 1.5rem);
        background: var(--bg-body);
        border-top: 1px solid var(--border-light);
    }

    .map-footer-text {
        font-size: 0.9rem;
        color: var(--text-body);
        margin: 0;
    }

    .map-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: transparent;
        border: 2px solid var(--color-accent);
        color: var(--color-primary);
        font-size: 0.8rem;
        font-weight: 700;
        text-transform: uppercase;
        text-decoration: none;
        letter-spacing: 0.05em;
        transition: all var(--transition-fast);
        clip-path: polygon(8px 0, 100% 0, calc(100% - 8px) 100%, 0 100%);
    }

    .map-link:hover {
        background: var(--color-accent);
        color: var(--color-primary);
        transform: translateY(-2px);
    }

    .map-link svg {
        width: 1rem;
        height: 1rem;
    }

    /* Responsive */
    @media (max-width: 640px) {
        .map-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .map-stats {
            width: 100%;
            justify-content: flex-start;
        }

        .map-footer {
            flex-direction: column;
            align-items: flex-start;
        }

        .map-badge {
            bottom: 0.5rem;
            left: 0.5rem;
            font-size: 0.65rem;
            padding: 0.375rem 0.75rem;
        }
    }
</style>
