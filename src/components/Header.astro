---
import { Image } from "astro:assets";
import { IMAGES } from "../config/images";
const logoImage = IMAGES.branding.logoNew;
import CtaButton from "./ui/CtaButton.astro";
import Container from "./ui/Container.astro";
import {
    ChevronDown,
    Zap,
    MapPin,
    ArrowRight,
    Menu,
    X,
    Phone,
} from "lucide-astro";
import { SITE_CONFIG } from "../config/site";

// Top services for mega menu
const topServices = [
    { name: "Panel Upgrades", slug: "electrical-panel-upgrade-100a-to-200a" },
    { name: "24/7 Emergency", slug: "24-7-emergency-electrical-service" },
    {
        name: "EV Charger Installation",
        slug: "level-2-ev-charger-installation",
    },
    { name: "Surge Protection", slug: "whole-home-surge-protection" },
    { name: "Recessed Lighting", slug: "recessed-lighting-installation" },
    {
        name: "Ceiling Fan Installation",
        slug: "ceiling-fan-light-fixture-installation",
    },
];

// Top service areas for mega menu
const topServiceAreas = [
    "Miami",
    "Fort Lauderdale",
    "Hollywood",
    "Pembroke Pines",
    "Miami Beach",
    "Coral Springs",
];
---

<header class="w-full font-secondary sticky top-0 z-[var(--z-sticky)]">
    <!-- Main Navbar -->
    <nav class="bg-white border-b border-gray-100 shadow-[var(--shadow-sm)]">
        <Container class="py-2 lg:py-3">
            <!-- Desktop Header (lg and up) -->
            <div
                class="hidden lg:grid lg:grid-cols-[minmax(180px,220px)_1fr_minmax(400px,auto)] items-center gap-4 xl:gap-8"
            >
                <!-- Left: Logo -->
                <a href="/" class="block w-full max-w-[220px]">
                    <Image
                        src={logoImage}
                        alt="Solomon Electric - Licensed Miami Electricians Since 2008"
                        class="w-full h-auto"
                    />
                </a>

                <!-- Center: Desktop Menu with Mega Menus -->
                <div class="flex items-center gap-4 xl:gap-6 justify-center">
                    <!-- Services Mega Menu -->
                    <div class="mega-menu-container group">
                        <a
                            href="/services"
                            class="mega-menu-trigger text-primary hover:text-accent transition-colors font-bold text-[14px] xl:text-[15px] tracking-wider uppercase whitespace-nowrap flex items-center gap-1 group/trigger"
                        >
                            <span class="shimmer-authority">Services</span>
                            <ChevronDown
                                class="w-3 h-3 transition-transform group-hover/trigger:rotate-180"
                            />
                        </a>
                        <div class="mega-menu">
                            <div class="mega-menu-content">
                                <div class="mega-menu-header">
                                    <span class="mega-menu-label"
                                        >‚ö° Popular Services</span
                                    >
                                </div>
                                <div class="mega-menu-grid">
                                    {
                                        topServices.map((service) => (
                                            <a
                                                href={`/services/${service.slug}`}
                                                class="mega-menu-item"
                                            >
                                                <Zap class="mega-menu-icon" />
                                                <span>{service.name}</span>
                                            </a>
                                        ))
                                    }
                                </div>
                                <a href="/services" class="mega-menu-view-all">
                                    View All Services
                                    <ArrowRight class="w-4 h-4" />
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Service Areas Mega Menu -->
                    <div class="mega-menu-container group">
                        <a
                            href="/service-areas"
                            class="mega-menu-trigger text-primary hover:text-accent transition-colors font-bold text-[14px] xl:text-[15px] tracking-wider uppercase whitespace-nowrap flex items-center gap-1 group/trigger"
                        >
                            <span class="shimmer-authority">Service Areas</span>
                            <ChevronDown
                                class="w-3 h-3 transition-transform group-hover/trigger:rotate-180"
                            />
                        </a>
                        <div class="mega-menu">
                            <div class="mega-menu-content">
                                <div class="mega-menu-header">
                                    <span class="mega-menu-label"
                                        >üìç Top Cities We Serve</span
                                    >
                                </div>
                                <div class="mega-menu-grid">
                                    {
                                        topServiceAreas.map((area) => (
                                            <a
                                                href={`/service-areas/${area.toLowerCase().replace(/\s+/g, "-")}`}
                                                class="mega-menu-item"
                                            >
                                                <MapPin class="mega-menu-icon" />
                                                <span>{area}</span>
                                            </a>
                                        ))
                                    }
                                </div>
                                <a
                                    href="/service-areas"
                                    class="mega-menu-view-all"
                                >
                                    View All Service Areas
                                    <ArrowRight class="w-4 h-4" />
                                </a>
                            </div>
                        </div>
                    </div>

                    <a
                        href="/faq"
                        class="text-primary hover:text-accent transition-colors font-bold text-[14px] xl:text-[15px] tracking-wider uppercase whitespace-nowrap"
                        >FAQ</a
                    >
                    <a
                        href="/reviews"
                        class="text-primary hover:text-accent transition-colors font-bold text-[14px] xl:text-[15px] tracking-wider uppercase whitespace-nowrap"
                        >Reviews</a
                    >
                    <a
                        href="/about"
                        class="text-primary hover:text-accent transition-colors font-bold text-[14px] xl:text-[15px] tracking-wider uppercase whitespace-nowrap"
                        >About</a
                    >
                    <a
                        href="/contact"
                        class="text-primary hover:text-accent transition-colors font-bold text-[14px] xl:text-[15px] tracking-wider uppercase whitespace-nowrap"
                        >Contact</a
                    >
                </div>

                <!-- Right: CTAs -->
                <div class="flex items-center gap-3 xl:gap-4 justify-end">
                    <CtaButton
                        action="book"
                        text="Book Online"
                        size="md"
                        class="whitespace-nowrap"
                    />
                    <CtaButton
                        action="call"
                        variant="secondary"
                        size="md"
                        class="whitespace-nowrap"
                    />
                </div>
            </div>

            <!-- Mobile & Tablet Header (below lg) -->
            <div class="flex lg:hidden items-center justify-between">
                <a href="/" class="block w-32 md:w-40 flex-shrink-0">
                    <Image
                        src={logoImage}
                        alt="Solomon Electric - Licensed Miami Electricians Since 2008"
                        class="w-full h-auto"
                    />
                </a>
                <button
                    id="mobile-menu-btn"
                    class="text-primary p-2"
                    aria-label="Open Menu"
                >
                    <Menu class="w-8 h-8" />
                </button>
            </div>
        </Container>
    </nav>
</header>

<!-- Mobile Menu Overlay (for phones and tablets) -->
<div
    id="mobile-menu"
    class="fixed inset-y-0 right-0 w-full max-w-[400px] bg-gradient-to-br from-[#0e4380] via-[#0a3a6e] to-[#082a50] z-[var(--z-modal)] transform translate-x-full transition-all duration-300 ease-out lg:hidden flex flex-col shadow-2xl overflow-y-auto backdrop-blur-sm"
>
    <!-- Glass Overlay Effect -->
    <div class="absolute inset-0 bg-white/5 backdrop-blur-md"></div>

    <!-- Header -->
    <div
        class="relative flex items-center justify-between p-8 bg-white border-b border-gray-200"
    >
        <a href="/" class="transition-transform hover:scale-105">
            <Image
                src={logoImage}
                alt="Solomon Electric - Licensed Miami Electricians Since 2008"
                class="h-[60px] w-auto object-contain"
            />
        </a>
        <button
            id="close-menu-btn"
            class="w-10 h-10 bg-primary/10 hover:bg-primary/20 flex items-center justify-center rounded-lg transition-all duration-200 hover:rotate-90 group"
            aria-label="Close Menu"
        >
            <X
                class="w-5 h-5 text-primary group-hover:text-accent transition-colors"
            />
        </button>
    </div>

    <!-- Content -->
    <div class="relative flex flex-col gap-12 px-8 py-6 flex-grow">
        <!-- Navigation Links -->
        <nav class="flex flex-col gap-6 animate-fade-in-up">
            <a
                href="/services"
                class="group flex items-center gap-3 font-secondary text-xl font-bold text-white hover:text-accent transition-all duration-200 hover:translate-x-2 py-2"
            >
                <Zap
                    class="w-5 h-5 text-accent group-hover:scale-110 transition-transform"
                />
                <span>Services</span>
                <ArrowRight
                    class="w-4 h-4 ml-auto opacity-0 group-hover:opacity-100 transition-opacity"
                />
            </a>
            <a
                href="/service-areas"
                class="group flex items-center gap-3 font-secondary text-xl font-bold text-white hover:text-accent transition-all duration-200 hover:translate-x-2 py-2"
            >
                <MapPin
                    class="w-5 h-5 text-accent group-hover:scale-110 transition-transform"
                />
                <span>Service Areas</span>
                <ArrowRight
                    class="w-4 h-4 ml-auto opacity-0 group-hover:opacity-100 transition-opacity"
                />
            </a>
            <a
                href="/faq"
                class="group flex items-center gap-3 font-secondary text-xl font-bold text-white hover:text-accent transition-all duration-200 hover:translate-x-2 py-2"
            >
                <span class="text-accent text-lg">‚ùì</span>
                <span>FAQ</span>
                <ArrowRight
                    class="w-4 h-4 ml-auto opacity-0 group-hover:opacity-100 transition-opacity"
                />
            </a>
            <a
                href="/reviews"
                class="group flex items-center gap-3 font-secondary text-xl font-bold text-white hover:text-accent transition-all duration-200 hover:translate-x-2 py-2"
            >
                <span class="text-accent text-lg">‚≠ê</span>
                <span>Reviews</span>
                <ArrowRight
                    class="w-4 h-4 ml-auto opacity-0 group-hover:opacity-100 transition-opacity"
                />
            </a>
            <a
                href="/about"
                class="group flex items-center gap-3 font-secondary text-xl font-bold text-white hover:text-accent transition-all duration-200 hover:translate-x-2 py-2"
            >
                <span class="text-accent text-lg">‚ÑπÔ∏è</span>
                <span>About</span>
                <ArrowRight
                    class="w-4 h-4 ml-auto opacity-0 group-hover:opacity-100 transition-opacity"
                />
            </a>
            <a
                href="/contact"
                class="group flex items-center gap-3 font-secondary text-xl font-bold text-white hover:text-accent transition-all duration-200 hover:translate-x-2 py-2"
            >
                <span class="text-accent text-lg">üìß</span>
                <span>Contact</span>
                <ArrowRight
                    class="w-4 h-4 ml-auto opacity-0 group-hover:opacity-100 transition-opacity"
                />
            </a>
        </nav>

        <!-- CTAs -->
        <div
            class="flex flex-col gap-4 mt-auto animate-fade-in-up"
            style="animation-delay: 0.1s;"
        >
            <!-- Divider -->
            <div
                class="h-px bg-gradient-to-r from-transparent via-white/20 to-transparent my-2"
            >
            </div>

            <!-- All Services Button -->
            <a
                href="/services"
                class="group relative flex items-center justify-center gap-3 px-6 py-4 bg-accent hover:bg-accent/90 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-accent/20 hover:scale-[1.02] overflow-hidden"
            >
                <div
                    class="absolute inset-0 bg-gradient-to-r from-accent/0 via-white/10 to-accent/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"
                >
                </div>
                <Zap class="w-5 h-5 text-primary relative z-10" />
                <span
                    class="font-secondary text-lg font-bold text-primary relative z-10"
                    >All Services</span
                >
                <ArrowRight
                    class="w-5 h-5 text-primary relative z-10 transition-transform group-hover:translate-x-1"
                />
            </a>

            <!-- Call Now Button -->
            <a
                href={SITE_CONFIG.contact.phone.href}
                class="group relative flex items-center justify-center gap-3 px-6 py-4 bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/20 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-white/10 hover:scale-[1.02] overflow-hidden"
            >
                <div
                    class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/10 to-white/0 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"
                >
                </div>
                <span
                    class="w-9 h-9 bg-accent rounded-lg flex items-center justify-center relative z-10 group-hover:scale-110 transition-transform"
                >
                    <Phone class="w-5 h-5 text-primary" />
                </span>
                <span
                    class="font-secondary text-lg font-bold text-white relative z-10"
                    >Call Now</span
                >
            </a>

            <!-- Contact Info -->
            <div class="text-center mt-4 space-y-2">
                <p
                    class="text-white/60 text-xs uppercase tracking-wider font-secondary"
                >
                    Available 24/7
                </p>
                <p class="text-accent text-xl font-bold font-secondary">
                    {SITE_CONFIG.contact.phone.display}
                </p>
            </div>
        </div>
    </div>
</div>

<style>
    /* =========================================
       MEGA MENU STYLES
       ========================================= */
    .mega-menu-container {
        position: relative;
    }

    .mega-menu-trigger {
        position: relative;
        z-index: 10;
    }

    .mega-menu {
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%) translateY(8px);
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
        transition: all 0.2s ease;
        padding-top: 12px; /* Gap between trigger and menu */
    }

    .mega-menu-container:hover .mega-menu {
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
        transform: translateX(-50%) translateY(0);
    }

    .mega-menu-content {
        background: white;
        border: 1px solid var(--border-light);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-xl);
        min-width: 280px;
        overflow: hidden;
        backdrop-filter: blur(var(--glass-blur));
        -webkit-backdrop-filter: blur(var(--glass-blur));
    }

    .mega-menu-header {
        padding: 0.75rem 1rem;
        background: linear-gradient(
            135deg,
            var(--color-primary) 0%,
            #0a3060 100%
        );
        border-bottom: 2px solid var(--color-accent);
    }

    .mega-menu-label {
        font-size: 0.7rem;
        font-weight: 700;
        color: white;
        text-transform: uppercase;
        letter-spacing: 0.1em;
    }

    .mega-menu-grid {
        padding: 0.5rem;
        display: flex;
        flex-direction: column;
    }

    .mega-menu-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.625rem 0.75rem;
        color: var(--text-body);
        font-size: 0.875rem;
        font-weight: 500;
        text-decoration: none;
        border-radius: var(--radius-md);
        transition: all 0.15s ease;
    }

    .mega-menu-item:hover {
        background: rgba(20, 211, 227, 0.08);
        color: var(--color-primary);
    }

    .mega-menu-item:hover .mega-menu-icon {
        color: var(--color-accent);
    }

    .mega-menu-icon {
        width: 1rem;
        height: 1rem;
        color: var(--color-primary);
        flex-shrink: 0;
        transition: color 0.15s ease;
    }

    .mega-menu-view-all {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem 1rem;
        background: var(--bg-surface);
        color: var(--color-primary);
        font-size: 0.8rem;
        font-weight: 700;
        text-transform: uppercase;
        text-decoration: none;
        letter-spacing: 0.05em;
        border-top: 1px solid var(--border-light);
        transition: all 0.15s ease;
    }

    .mega-menu-view-all:hover {
        background: var(--color-accent);
        color: var(--color-primary);
    }

    .mega-menu-view-all svg {
        width: 1rem;
        height: 1rem;
    }

    /* =========================================
       MOBILE MENU ANIMATIONS
       ========================================= */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-fade-in-up {
        animation: fadeInUp 0.4s ease-out forwards;
    }

    /* Mobile menu backdrop */
    #mobile-menu-backdrop {
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
    }
</style>

<script>
    const menuBtn = document.getElementById("mobile-menu-btn");
    const closeBtn = document.getElementById("close-menu-btn");
    const menu = document.getElementById("mobile-menu");

    // Create backdrop
    const backdrop = document.createElement("div");
    backdrop.id = "mobile-menu-backdrop";
    backdrop.className =
        "fixed inset-0 bg-black/50 z-[calc(var(--z-modal)-1)] opacity-0 pointer-events-none transition-opacity duration-300 lg:hidden";
    document.body.appendChild(backdrop);

    function toggleMenu() {
        const isOpen = !menu?.classList.contains("translate-x-full");

        menu?.classList.toggle("translate-x-full");
        document.body.classList.toggle("overflow-hidden");

        // Toggle backdrop
        if (!isOpen) {
            backdrop.classList.remove("pointer-events-none");
            backdrop.classList.remove("opacity-0");
        } else {
            backdrop.classList.add("opacity-0");
            setTimeout(() => {
                backdrop.classList.add("pointer-events-none");
            }, 300);
        }
    }

    menuBtn?.addEventListener("click", toggleMenu);
    closeBtn?.addEventListener("click", toggleMenu);
    backdrop?.addEventListener("click", toggleMenu);

    menu?.querySelectorAll("a").forEach((link) => {
        link.addEventListener("click", toggleMenu);
    });
</script>
