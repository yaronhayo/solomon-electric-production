---
// PageLoader.astro - Lightweight page preloader with favicon branding
---

<div id="page-loader" class="page-loader" aria-hidden="true">
    <div class="loader-content">
        <img
            src="/favicon.png"
            alt=""
            width="48"
            height="48"
            class="loader-logo"
            fetchpriority="high"
        />
        <div class="loader-spinner"></div>
        <p class="loader-text">Solomon Electric</p>
    </div>
</div>

<style>
    .page-loader {
        position: fixed;
        inset: 0;
        background: var(--color-light, #f8fafc);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition:
            opacity 0.3s ease-out,
            visibility 0.3s ease-out;
    }

    .page-loader.loaded {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
    }

    .loader-content {
        text-align: center;
    }

    .loader-logo {
        width: 48px;
        height: 48px;
        margin: 0 auto 1rem;
        animation: pulse-glow 1.5s ease-in-out infinite;
    }

    .loader-spinner {
        width: 56px;
        height: 56px;
        border: 3px solid transparent;
        border-top-color: var(--color-accent, #14d3e3);
        border-radius: 50%;
        animation: spin 0.7s linear infinite;
        margin: 0 auto 0.75rem;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        margin-top: -24px;
    }

    .loader-text {
        font-family: var(--font-display, system-ui);
        font-size: 0.75rem;
        font-weight: 700;
        color: var(--color-primary, #0d4380);
        text-transform: uppercase;
        letter-spacing: 0.15em;
        margin-top: 0.5rem;
    }

    @keyframes spin {
        to {
            transform: translate(-50%, -50%) rotate(360deg);
        }
    }

    @keyframes pulse-glow {
        0%,
        100% {
            opacity: 1;
            filter: drop-shadow(0 0 0 transparent);
        }
        50% {
            opacity: 0.8;
            filter: drop-shadow(0 0 10px rgba(20, 211, 227, 0.4));
        }
    }
</style>

<script is:inline>
    // Immediately hide loader once DOM is interactive (faster than 'load')
    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", hideLoader);
    } else {
        hideLoader();
    }

    function hideLoader() {
        const loader = document.getElementById("page-loader");
        if (loader) {
            // Small delay for visual polish, but faster than before
            requestAnimationFrame(() => {
                loader.classList.add("loaded");
                setTimeout(() => loader.remove(), 300);
            });
        }
    }
</script>
